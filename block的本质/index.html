<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Hello World | yahaoâ€˜s note</title>
  <meta name="keywords" content="">
  <meta name="description" content="Hello World | yahaoâ€˜s note">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick">
<meta property="og:type" content="article">
<meta property="og:title" content="Hello World">
<meta property="og:url" content="https://xieyahao.github.io/blog/hello-world/index.html">
<meta property="og:site_name" content="yahaoâ€˜s note">
<meta property="og:description" content="Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick">
<meta property="og:locale" content="zh">
<meta property="article:published_time" content="2020-05-29T10:29:00.486Z">
<meta property="article:modified_time" content="2020-05-29T10:29:00.486Z">
<meta name="twitter:card" content="summary">


<link rel="icon" href="/img/avatar.jpg">

<link href="/blog/css/style.css?v=1.1.0" rel="stylesheet">

<link href="/blog/css/hl_theme/atom-light.css?v=1.1.0" rel="stylesheet">

<link href="//cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css" rel="stylesheet">

<script src="//cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<script src="/blog/js/titleTip.js?v=1.1.0" ></script>

<script src="//cdn.jsdelivr.net/npm/highlightjs@9.16.2/highlight.pack.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>

<script src="//cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script>



<script src="//cdn.jsdelivr.net/npm/jquery.cookie@1.4.1/jquery.cookie.min.js" ></script>

<script src="/blog/js/iconfont.js?v=1.1.0" ></script>

<meta name="generator" content="Hexo 4.2.1"></head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_preload_comment" value="">
  <input class="theme_blog_path" value="/blog">
  <input id="theme_shortcut" value="true" />
</div>


<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/blog/" class="avatar_target">
    <img class="avatar" src="/blog/img/avatar.jpg" />
</a>
<div class="author">
    <span></span>
</div>

<div class="icon">
    
</div>




<ul>
    <li><div class="all active" data-rel="All">All<small>(3)</small></div></li>
    
</ul>
<div class="left-bottom">
    <div class="menus">
    
    
    
    
    </div>
    <div><a class="about  hasFriend  site_url"  href="/about">About</a><a style="width: 50%"  class="friends">Friends</a></div>
</div>
<input type="hidden" id="yelog_site_posts_number" value="3">

<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>

    </div>
    <div class="nav-right">
        <div class="friends-area">
    <div class="friends-title">
        Links
        <i class="iconfont icon-left"></i>
    </div>
    <div class="friends-content">
        <ul>
            
        </ul>
    </div>
</div>
        <div class="title-list">
    <div class="right-top">
        <div id="default-panel">
            <i class="iconfont icon-search" data-title="æœç´¢ å¿«æ·é”® i"></i>
            <div class="right-title">All</div>
            <i class="iconfont icon-file-tree" data-title="åˆ‡æ¢åˆ°å¤§çº²è§†å›¾ å¿«æ·é”® w"></i>
        </div>
        <div id="search-panel">
            <i class="iconfont icon-left" data-title="è¿”å›"></i>
            <input id="local-search-input" />
            <label class="border-line" for="input"></label>
            <i class="iconfont icon-case-sensitive" data-title="å¤§å°å†™æ•æ„Ÿ"></i>
            <i class="iconfont icon-tag" data-title="æ ‡ç­¾"></i>
        </div>
        <div id="outline-panel" style="display: none">
            <div class="right-title">å¤§çº²</div>
            <i class="iconfont icon-list" data-title="åˆ‡æ¢åˆ°æ–‡ç« åˆ—è¡¨"></i>
        </div>
    </div>

    <div class="tags-list">
    <input id="tag-search" />
    <div class="tag-wrapper">
        
    </div>

</div>

    
    <nav id="title-list-nav">
        
        <a  class="All "
           href="/blog/hello-world/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Hello World">Hello World</span>
            <span class="post-date" title="2020-05-29 18:29:00">2020/05/29</span>
        </a>
        
        <a  class="All "
           href="/blog/block%E7%9A%84%E6%9C%AC%E8%B4%A8/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Hello World">Hello World</span>
            <span class="post-date" title="2020-05-29 18:29:00">2020/05/29</span>
        </a>
        
        <a  class="All "
           href="/blog/runtime%E5%AD%A6%E4%B9%A0%E4%B8%80/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="runtimeå­¦ä¹ ä¸€">runtimeå­¦ä¹ ä¸€</span>
            <span class="post-date" title="2020-05-28 15:43:26">2020/05/28</span>
        </a>
        
        <div id="no-item-tips">

        </div>
    </nav>
    <div id="outline-list">
    </div>
</div>
    </div>
    <div class="hide-list">
        <div class="semicircle" data-title="åˆ‡æ¢å…¨å± å¿«æ·é”® s">
            <div class="brackets first"><</div>
            <div class="brackets">&gt;</div>
        </div>
    </div>
</aside>
<div id="post">
    <div class="pjax">
        <article id="post-blockçš„æœ¬è´¨" class="article article-type-post" itemscope itemprop="blogPost">
    
        <h1 class="article-title">Hello World</h1>
    
    <div class="article-meta">
        
        
        
        
    </div>
    <div class="article-meta">
        
            Created At : <time class="date" title='Updated At: 2020-06-08 18:42:26'>2020-05-29 18:29</time>
        
    </div>
    <div class="article-meta">
        
        
        <span id="busuanzi_container_page_pv">
            Views ğŸ‘€ :<span id="busuanzi_value_page_pv">
                <span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </span>
        </span>
        
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#ä¸€ã€ocä¸­çš„block"><span class="toc-text">ä¸€ã€ocä¸­çš„block</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1ã€æŠŠä¸‹é¢çš„ä»£ç ï¼Œä½¿ç”¨å‘½ä»¤è¡Œ-xcrun-sdk-iphonesimulator-clang-rewrite-objc-main-m-å°†main-mæ–‡ä»¶è½¬åŒ–ä¸ºC-æŸ¥çœ‹å†…éƒ¨ç»“æ„ã€‚"><span class="toc-text">1ã€æŠŠä¸‹é¢çš„ä»£ç ï¼Œä½¿ç”¨å‘½ä»¤è¡Œ xcrun -sdk iphonesimulator clang -rewrite-objc main.m å°†main.mæ–‡ä»¶è½¬åŒ–ä¸ºC++æŸ¥çœ‹å†…éƒ¨ç»“æ„ã€‚</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2ã€å…ˆçœ‹block-çš„å®šä¹‰ï¼š"><span class="toc-text">2ã€å…ˆçœ‹block çš„å®šä¹‰ï¼š</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3ã€å›è¿‡å¤´æ¥æŸ¥çœ‹-main-block-impl-0ç»“æ„ä½“"><span class="toc-text">3ã€å›è¿‡å¤´æ¥æŸ¥çœ‹__main_block_impl_0ç»“æ„ä½“</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4ã€è°ƒç”¨blockæ‰§è¡Œå†…éƒ¨ä»£ç "><span class="toc-text">4ã€è°ƒç”¨blockæ‰§è¡Œå†…éƒ¨ä»£ç </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5ã€å¦‚ä½•éªŒè¯blockçš„æœ¬è´¨ç¡®å®æ˜¯-main-block-impl-0ç»“æ„ä½“ç±»å‹ã€‚"><span class="toc-text">5ã€å¦‚ä½•éªŒè¯blockçš„æœ¬è´¨ç¡®å®æ˜¯__main_block_impl_0ç»“æ„ä½“ç±»å‹ã€‚</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#äºŒã€blockçš„å˜é‡æ•è·"><span class="toc-text">äºŒã€blockçš„å˜é‡æ•è·</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1ã€å±€éƒ¨å˜é‡"><span class="toc-text">1ã€å±€éƒ¨å˜é‡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2ã€staticå˜é‡"><span class="toc-text">2ã€staticå˜é‡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3ã€å…¨å±€å˜é‡"><span class="toc-text">3ã€å…¨å±€å˜é‡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4ã€å®ä¾‹å˜é‡"><span class="toc-text">4ã€å®ä¾‹å˜é‡</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ä¸‰ã€blockçš„ç±»å‹"><span class="toc-text">ä¸‰ã€blockçš„ç±»å‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1ã€blockå¯¹è±¡æ˜¯ä»€ä¹ˆç±»å‹å‘¢ï¼Ÿ"><span class="toc-text">1ã€blockå¯¹è±¡æ˜¯ä»€ä¹ˆç±»å‹å‘¢ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2ã€blockçš„ä¸‰ç§ç±»å‹"><span class="toc-text">2ã€blockçš„ä¸‰ç§ç±»å‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3ã€blockåœ¨å†…å­˜ä¸­çš„å­˜å‚¨"><span class="toc-text">3ã€blockåœ¨å†…å­˜ä¸­çš„å­˜å‚¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4ã€blockæ˜¯å¦‚ä½•å®šä¹‰å…¶ç±»å‹"><span class="toc-text">4ã€blockæ˜¯å¦‚ä½•å®šä¹‰å…¶ç±»å‹</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#aã€blockä½œä¸ºå‡½æ•°è¿”å›å€¼æ—¶"><span class="toc-text">aã€blockä½œä¸ºå‡½æ•°è¿”å›å€¼æ—¶</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#bã€å°†blockèµ‹å€¼ç»™-strongæŒ‡é’ˆæ—¶"><span class="toc-text">bã€å°†blockèµ‹å€¼ç»™__strongæŒ‡é’ˆæ—¶</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cã€blockä½œä¸ºCocoa-APIä¸­æ–¹æ³•åå«æœ‰usingBlockçš„æ–¹æ³•å‚æ•°æ—¶"><span class="toc-text">cã€blockä½œä¸ºCocoa APIä¸­æ–¹æ³•åå«æœ‰usingBlockçš„æ–¹æ³•å‚æ•°æ—¶</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#dã€blockä½œä¸ºGCD-APIçš„æ–¹æ³•å‚æ•°æ—¶"><span class="toc-text">dã€blockä½œä¸ºGCD APIçš„æ–¹æ³•å‚æ•°æ—¶</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å››ã€blockå£°æ˜å†™æ³•"><span class="toc-text">å››ã€blockå£°æ˜å†™æ³•</span></a></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-3 i,
    .toc-level-3 ol {
        display: none !important;
    }
</style>
</div>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>#blockçš„æœ¬è´¨</p>
<h2 id="ä¸€ã€ocä¸­çš„block"><a href="#ä¸€ã€ocä¸­çš„block" class="headerlink" title="ä¸€ã€ocä¸­çš„block"></a>ä¸€ã€ocä¸­çš„block</h2><h3 id="1ã€æŠŠä¸‹é¢çš„ä»£ç ï¼Œä½¿ç”¨å‘½ä»¤è¡Œ-xcrun-sdk-iphonesimulator-clang-rewrite-objc-main-m-å°†main-mæ–‡ä»¶è½¬åŒ–ä¸ºC-æŸ¥çœ‹å†…éƒ¨ç»“æ„ã€‚"><a href="#1ã€æŠŠä¸‹é¢çš„ä»£ç ï¼Œä½¿ç”¨å‘½ä»¤è¡Œ-xcrun-sdk-iphonesimulator-clang-rewrite-objc-main-m-å°†main-mæ–‡ä»¶è½¬åŒ–ä¸ºC-æŸ¥çœ‹å†…éƒ¨ç»“æ„ã€‚" class="headerlink" title="1ã€æŠŠä¸‹é¢çš„ä»£ç ï¼Œä½¿ç”¨å‘½ä»¤è¡Œ xcrun -sdk iphonesimulator clang -rewrite-objc main.m å°†main.mæ–‡ä»¶è½¬åŒ–ä¸ºC++æŸ¥çœ‹å†…éƒ¨ç»“æ„ã€‚"></a>1ã€æŠŠä¸‹é¢çš„ä»£ç ï¼Œä½¿ç”¨å‘½ä»¤è¡Œ xcrun -sdk iphonesimulator clang -rewrite-objc main.m å°†main.mæ–‡ä»¶è½¬åŒ–ä¸ºC++æŸ¥çœ‹å†…éƒ¨ç»“æ„ã€‚</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> * argv[])</span> </span>&#123;</span><br><span class="line">    @autoreleasepool &#123;</span><br><span class="line">        <span class="keyword">int</span> age = <span class="number">10</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">void</span> (^yhBlock)(<span class="keyword">int</span> a,<span class="keyword">int</span> b) = ^(<span class="keyword">int</span> a,<span class="keyword">int</span> b) &#123;</span><br><span class="line">            NSLog(@<span class="string">"%d"</span>, a + b );</span><br><span class="line">            NSLog(@<span class="string">"blockå†… age = %d"</span>, age );</span><br><span class="line">        &#125;;</span><br><span class="line">        </span><br><span class="line">        age = <span class="number">20</span>;</span><br><span class="line">        NSLog(@<span class="string">"block æ‰§è¡Œå‰age = %d"</span>, age );</span><br><span class="line"></span><br><span class="line">        yhBlock(<span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line">        age = <span class="number">30</span>;</span><br><span class="line">             </span><br><span class="line">        NSLog(@<span class="string">"block æ‰§è¡Œåage = %d"</span>, age );</span><br><span class="line">        <span class="keyword">return</span> UIApplicationMain(argc, argv, nil, NSStringFromClass([AppDelegate class]));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> __<span class="title">block_impl</span> &#123;</span></span><br><span class="line">  <span class="keyword">void</span> *isa;</span><br><span class="line">  <span class="keyword">int</span> Flags;</span><br><span class="line">  <span class="keyword">int</span> Reserved;</span><br><span class="line">  <span class="keyword">void</span> *FuncPtr;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> __<span class="title">main_block_impl_0</span> &#123;</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> __<span class="title">block_impl</span> <span class="title">impl</span>;</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> __<span class="title">main_block_desc_0</span>* <span class="title">Desc</span>;</span></span><br><span class="line">  <span class="keyword">int</span> age;</span><br><span class="line">  __main_block_impl_0(<span class="keyword">void</span> *fp, struct __main_block_desc_0 *desc, <span class="keyword">int</span> _age, <span class="keyword">int</span> flags=<span class="number">0</span>) : age(_age) &#123;</span><br><span class="line">    impl.isa = &amp;_NSConcreteStackBlock;</span><br><span class="line">    impl.Flags = flags;</span><br><span class="line">    impl.FuncPtr = fp;</span><br><span class="line">    Desc = desc;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> __main_block_func_0(struct __main_block_impl_0 *__cself, <span class="keyword">int</span> a, <span class="keyword">int</span> b) &#123;</span><br><span class="line">  <span class="keyword">int</span> age = __cself-&gt;age; <span class="comment">// bound by copy</span></span><br><span class="line"></span><br><span class="line">            NSLog((NSString *)&amp;__NSConstantStringImpl__var_folders_tl_9wc89m9x72x0tlbwylxrqk140000gn_T_main_c2896e_mi_0, a + b );</span><br><span class="line">            NSLog((NSString *)&amp;__NSConstantStringImpl__var_folders_tl_9wc89m9x72x0tlbwylxrqk140000gn_T_main_c2896e_mi_1, age );</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">struct</span> __<span class="title">main_block_desc_0</span> &#123;</span></span><br><span class="line">  <span class="keyword">size_t</span> reserved;</span><br><span class="line">  <span class="keyword">size_t</span> Block_size;</span><br><span class="line">&#125; __main_block_desc_0_DATA = &#123; <span class="number">0</span>, <span class="keyword">sizeof</span>(struct __main_block_impl_0)&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> * argv[])</span> </span>&#123;</span><br><span class="line">    <span class="comment">/* @autoreleasepool */</span> &#123; __AtAutoreleasePool __autoreleasepool; </span><br><span class="line">        <span class="keyword">int</span> age = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">void</span> (*yhBlock)(<span class="keyword">int</span> a,<span class="keyword">int</span> b) = ((<span class="keyword">void</span> (*)(<span class="keyword">int</span>, <span class="keyword">int</span>))&amp;__main_block_impl_0((<span class="keyword">void</span> *)__main_block_func_0, &amp;__main_block_desc_0_DATA, age));</span><br><span class="line"></span><br><span class="line">        age = <span class="number">20</span>;</span><br><span class="line">        NSLog((NSString *)&amp;__NSConstantStringImpl__var_folders_tl_9wc89m9x72x0tlbwylxrqk140000gn_T_main_c2896e_mi_2, age );</span><br><span class="line"></span><br><span class="line">        ((<span class="keyword">void</span> (*)(__block_impl *, <span class="keyword">int</span>, <span class="keyword">int</span>))((__block_impl *)yhBlock)-&gt;FuncPtr)((__block_impl *)yhBlock, <span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        age = <span class="number">30</span>;</span><br><span class="line"></span><br><span class="line">        NSLog((NSString *)&amp;__NSConstantStringImpl__var_folders_tl_9wc89m9x72x0tlbwylxrqk140000gn_T_main_c2896e_mi_3, age );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> UIApplicationMain(argc, argv, __null, NSStringFromClass(((Class (*)(id, SEL))(<span class="keyword">void</span> *)objc_msgSend)((id)objc_getClass(<span class="string">"AppDelegate"</span>), sel_registerName(<span class="string">"class"</span>))));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2ã€å…ˆçœ‹block-çš„å®šä¹‰ï¼š"><a href="#2ã€å…ˆçœ‹block-çš„å®šä¹‰ï¼š" class="headerlink" title="2ã€å…ˆçœ‹block çš„å®šä¹‰ï¼š"></a>2ã€å…ˆçœ‹block çš„å®šä¹‰ï¼š</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> (*yhBlock)(<span class="keyword">int</span> a,<span class="keyword">int</span> b) = ((<span class="keyword">void</span> (*)(<span class="keyword">int</span>, <span class="keyword">int</span>))&amp;__main_block_impl_0((<span class="keyword">void</span> *)__main_block_func_0, &amp;__main_block_desc_0_DATA, age));</span><br></pre></td></tr></table></figure>
<p>è°ƒç”¨äº† <strong>main_block_impl_0 æ–¹æ³•ï¼Œå¹¶æŠŠè¿™ä¸ªå‡½æ•°çš„åœ°å€èµ‹ç»™äº† blockã€‚è¯¥å‡½æ•°è¿˜åŒ…å«äº†ä¸‰ä¸ªå‚æ•°ã€‚çœ‹ä¸€ä¸‹</strong>main_block_impl_0çš„å†…éƒ¨æ„é€ ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> __<span class="title">main_block_impl_0</span> &#123;</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> __<span class="title">block_impl</span> <span class="title">impl</span>;</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> __<span class="title">main_block_desc_0</span>* <span class="title">Desc</span>;</span></span><br><span class="line">  <span class="keyword">int</span> age;</span><br><span class="line"></span><br><span class="line">  __main_block_impl_0(<span class="keyword">void</span> *fp, struct __main_block_desc_0 *desc, <span class="keyword">int</span> _age, <span class="keyword">int</span> flags=<span class="number">0</span>) : age(_age) &#123;</span><br><span class="line">    impl.isa = &amp;_NSConcreteStackBlock;</span><br><span class="line">    impl.Flags = flags;</span><br><span class="line">    impl.FuncPtr = fp;</span><br><span class="line">    Desc = desc;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>åŒ…å«ä¸€ä¸ªåŒåæ„é€ å‡½æ•°<strong>main_block_impl_0ï¼Œå¯¹ä¸€äº›å˜é‡èµ‹å€¼æœ€ç»ˆè¿”å›çš„æ˜¯è¿™ä¸ªç»“æ„ä½“ã€‚block = è¿”å›çš„</strong>main_block_impl_0ç»“æ„ä½“åœ°å€ã€‚</p>
<p>å‚æ•°åˆ†æï¼š<br>ç¬¬ä¸€ä¸ªå‚æ•°ï¼š<strong>main_block_func_0ï¼Œæ‰¾åˆ°å®šä¹‰å‘ç°äº†ä¸¤ä¸ªç†Ÿæ‚‰çš„NSLogï¼Œè¿™ä¸¤æ®µä»£ç æ°æ°æ˜¯æˆ‘ä»¬åœ¨blockå—ä¸­å†™ä¸‹çš„ä»£ç ã€‚ é‚£ä¹ˆ</strong>main_block_func_0å‡½æ•°ä¸­å…¶å®å­˜å‚¨ç€æˆ‘ä»¬blockä¸­å†™ä¸‹çš„ä»£ç ï¼Œä¹Ÿå°±æ˜¯ï¼›<br>å†™åœ¨blockå—ä¸­çš„ä»£ç å°è£…æˆ<strong>main_block_func_0å‡½æ•°ï¼Œå¹¶å°†</strong>main_block_func_0å‡½æ•°çš„åœ°å€ä¼ å…¥äº†__main_block_impl_0çš„æ„é€ å‡½æ•°ä¸­ä¿å­˜åœ¨ç»“æ„ä½“å†…ã€‚</p>
<p>ç¬¬äºŒä¸ªå‚æ•°ï¼š&amp;__main_block_desc_0_DATA<br>æŸ¥çœ‹å†…éƒ¨ç»“æ„ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">struct</span> __<span class="title">main_block_desc_0</span> &#123;</span></span><br><span class="line">  <span class="keyword">size_t</span> reserved;</span><br><span class="line">  <span class="keyword">size_t</span> Block_size;</span><br><span class="line">&#125; __main_block_desc_0_DATA = &#123; <span class="number">0</span>, <span class="keyword">sizeof</span>(struct __main_block_impl_0)&#125;;</span><br></pre></td></tr></table></figure>
<p><strong>main_block_desc_0ä¸­å­˜å‚¨ç€ä¸¤ä¸ªå‚æ•°ï¼Œreservedå’ŒBlock_sizeï¼Œå¹¶ä¸”reservedèµ‹å€¼ä¸º0ï¼Œè€ŒBlock_sizeåˆ™å­˜å‚¨ç€</strong>main_block_impl_0çš„å ç”¨ç©ºé—´å¤§å°ã€‚æ„é€ å‡½æ•°ä¸­ï¼Œå°†<strong>main_block_desc_0ç»“æ„ä½“çš„åœ°å€ä¼ å…¥</strong>main_block_func_0ä¸­èµ‹å€¼ç»™Descã€‚</p>
<p>ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šage<br>ageä¹Ÿå°±æ˜¯æˆ‘ä»¬å®šä¹‰çš„å±€éƒ¨å˜é‡ã€‚å› ä¸ºåœ¨blockå—ä¸­ä½¿ç”¨åˆ°ageå±€éƒ¨å˜é‡ï¼Œæ‰€ä»¥åœ¨blockå£°æ˜çš„æ—¶å€™è¿™é‡Œæ‰ä¼šå°†ageä½œä¸ºå‚æ•°ä¼ å…¥ï¼Œä¹Ÿå°±è¯´blockä¼šæ•è·ageï¼Œå¦‚æœæ²¡æœ‰åœ¨blockä¸­ä½¿ç”¨ageï¼Œè¿™é‡Œå°†åªä¼šä¼ å…¥(void *)<strong>main_block_func_0ï¼Œ&amp;</strong>main_block_desc_0_DATAä¸¤ä¸ªå‚æ•°ã€‚</p>
<p>Q ï¼šä¸ºä»€ä¹ˆå½“æˆ‘ä»¬åœ¨å®šä¹‰blockä¹‹åä¿®æ”¹å±€éƒ¨å˜é‡ageçš„å€¼ï¼Œåœ¨blockè°ƒç”¨çš„æ—¶å€™æ— æ³•ç”Ÿæ•ˆï¼Ÿ<br>A ï¼š å› ä¸ºblockåœ¨å®šä¹‰çš„ä¹‹åå·²ç»å°†ageçš„å€¼ä¼ å…¥å­˜å‚¨åœ¨__main_block_imp_0ç»“æ„ä½“ä¸­å¹¶åœ¨è°ƒç”¨çš„æ—¶å€™å°†ageä»blockä¸­å–å‡ºæ¥ä½¿ç”¨ï¼Œå› æ­¤åœ¨blockå®šä¹‰ä¹‹åå¯¹å±€éƒ¨å˜é‡è¿›è¡Œæ”¹å˜æ˜¯æ— æ³•è¢«blockæ•è·çš„ã€‚</p>
<h3 id="3ã€å›è¿‡å¤´æ¥æŸ¥çœ‹-main-block-impl-0ç»“æ„ä½“"><a href="#3ã€å›è¿‡å¤´æ¥æŸ¥çœ‹-main-block-impl-0ç»“æ„ä½“" class="headerlink" title="3ã€å›è¿‡å¤´æ¥æŸ¥çœ‹__main_block_impl_0ç»“æ„ä½“"></a>3ã€å›è¿‡å¤´æ¥æŸ¥çœ‹__main_block_impl_0ç»“æ„ä½“</h3>



<p><strong>block_implç»“æ„ä½“å†…éƒ¨å°±æœ‰ä¸€ä¸ªisaæŒ‡é’ˆã€‚å› æ­¤å¯ä»¥è¯æ˜blockæœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªocå¯¹è±¡ã€‚è€Œåœ¨æ„é€ å‡½æ•°ä¸­å°†å‡½æ•°ä¸­ä¼ å…¥çš„å€¼åˆ†åˆ«å­˜å‚¨åœ¨</strong>main_block_impl_0ç»“æ„ä½“å®ä¾‹ä¸­ï¼Œæœ€ç»ˆå°†ç»“æ„ä½“çš„åœ°å€èµ‹å€¼ç»™blockã€‚</p>
<p>ä¸Šé¢å¯¹__main_block_impl_0ç»“æ„ä½“æ„é€ å‡½æ•°ä¸‰ä¸ªå‚æ•°çš„åˆ†ææˆ‘ä»¬å¯ä»¥å¾—å‡ºç»“è®ºï¼š</p>
<ol>
<li>__block_implç»“æ„ä½“ä¸­isaæŒ‡é’ˆå­˜å‚¨ç€&amp;_NSConcreteStackBlockåœ°å€ï¼Œå¯ä»¥æš‚æ—¶ç†è§£ä¸ºå…¶ç±»å¯¹è±¡åœ°å€ï¼Œblockå°±æ˜¯_NSConcreteStackBlockç±»å‹çš„ã€‚</li>
<li>blockä»£ç å—ä¸­çš„ä»£ç è¢«å°è£…æˆ<strong>main_block_func_0å‡½æ•°ï¼ŒFuncPtråˆ™å­˜å‚¨ç€</strong>main_block_func_0å‡½æ•°çš„åœ°å€ã€‚</li>
<li>DescæŒ‡å‘<strong>main_block_desc_0ç»“æ„ä½“å¯¹è±¡ï¼Œå…¶ä¸­å­˜å‚¨</strong>main_block_impl_0ç»“æ„ä½“æ‰€å ç”¨çš„å†…å­˜ã€‚</li>
</ol>
<h3 id="4ã€è°ƒç”¨blockæ‰§è¡Œå†…éƒ¨ä»£ç "><a href="#4ã€è°ƒç”¨blockæ‰§è¡Œå†…éƒ¨ä»£ç " class="headerlink" title="4ã€è°ƒç”¨blockæ‰§è¡Œå†…éƒ¨ä»£ç "></a>4ã€è°ƒç”¨blockæ‰§è¡Œå†…éƒ¨ä»£ç </h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">((<span class="keyword">void</span> (*)(__block_impl *, <span class="keyword">int</span>, <span class="keyword">int</span>))((__block_impl *)yhBlock)-&gt;FuncPtr)((__block_impl *)yhBlock, <span class="number">1</span>, <span class="number">2</span>);</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡ä¸Šè¿°ä»£ç å¯ä»¥å‘ç°,è°ƒç”¨blockæ˜¯é€šè¿‡blockæ‰¾åˆ°FunPtrç›´æ¥è°ƒç”¨ï¼Œé€šè¿‡ä¸Šé¢åˆ†ææˆ‘ä»¬çŸ¥é“blockæŒ‡å‘çš„æ˜¯<strong>main_block_impl_0ç±»å‹ç»“æ„ä½“ï¼Œä½†æ˜¯æˆ‘ä»¬å‘ç°</strong>main_block_impl_0ç»“æ„ä½“ä¸­å¹¶ä¸ç›´æ¥å°±å¯ä»¥æ‰¾åˆ°FunPtrï¼Œè€ŒFunPtræ˜¯å­˜å‚¨åœ¨<strong>block_implä¸­çš„ï¼Œä¸ºä»€ä¹ˆblockå¯ä»¥ç›´æ¥è°ƒç”¨</strong>block_implä¸­çš„FunPtrå‘¢ï¼Ÿ</p>
<p>é‡æ–°æŸ¥çœ‹ä¸Šè¿°æºä»£ç å¯ä»¥å‘ç°ï¼Œ(<strong>block_impl *)blockå°†blockå¼ºåˆ¶è½¬åŒ–ä¸º</strong>block_implç±»å‹çš„ï¼Œå› ä¸º<strong>block_implæ˜¯</strong>main_block_impl_0ç»“æ„ä½“çš„ç¬¬ä¸€ä¸ªæˆå‘˜ï¼Œç›¸å½“äºå°†<strong>block_implç»“æ„ä½“çš„æˆå‘˜ç›´æ¥æ‹¿å‡ºæ¥æ”¾åœ¨</strong>main_block_impl_0ä¸­ï¼Œé‚£ä¹ˆä¹Ÿå°±è¯´æ˜<strong>block_implçš„å†…å­˜åœ°å€å°±æ˜¯</strong>main_block_impl_0ç»“æ„ä½“çš„å†…å­˜åœ°å€å¼€å¤´ã€‚æ‰€ä»¥å¯ä»¥è½¬åŒ–æˆåŠŸã€‚å¹¶æ‰¾åˆ°FunPtræˆå‘˜ã€‚</p>
<p>ä¸Šé¢æˆ‘ä»¬çŸ¥é“ï¼ŒFunPträ¸­å­˜å‚¨ç€é€šè¿‡ä»£ç å—å°è£…çš„å‡½æ•°åœ°å€ï¼Œé‚£ä¹ˆè°ƒç”¨æ­¤å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯ä¼šæ‰§è¡Œä»£ç å—ä¸­çš„ä»£ç ã€‚</p>
<p>æŸ¥çœ‹<strong>main_block_func_0å‡½æ•°ï¼Œå¯ä»¥å‘ç°ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯</strong>main_block_impl_0ç±»å‹çš„æŒ‡é’ˆã€‚ä¹Ÿå°±æ˜¯è¯´å°†blockä¼ å…¥__main_block_func_0å‡½æ•°ä¸­ï¼Œä¾¿äºé‡ä¸­å–å‡ºblockæ•è·çš„å€¼ã€‚</p>
<h3 id="5ã€å¦‚ä½•éªŒè¯blockçš„æœ¬è´¨ç¡®å®æ˜¯-main-block-impl-0ç»“æ„ä½“ç±»å‹ã€‚"><a href="#5ã€å¦‚ä½•éªŒè¯blockçš„æœ¬è´¨ç¡®å®æ˜¯-main-block-impl-0ç»“æ„ä½“ç±»å‹ã€‚" class="headerlink" title="5ã€å¦‚ä½•éªŒè¯blockçš„æœ¬è´¨ç¡®å®æ˜¯__main_block_impl_0ç»“æ„ä½“ç±»å‹ã€‚"></a>5ã€å¦‚ä½•éªŒè¯blockçš„æœ¬è´¨ç¡®å®æ˜¯__main_block_impl_0ç»“æ„ä½“ç±»å‹ã€‚</h3><p> åŒæ ·ä½¿ç”¨ä¹‹å‰çš„æ–¹æ³•ï¼Œæˆ‘ä»¬æŒ‰ç…§ä¸Šé¢åˆ†æçš„blockå†…éƒ¨ç»“æ„è‡ªå®šä¹‰ç»“æ„ä½“ï¼Œå¹¶å°†blockå†…éƒ¨çš„ç»“æ„ä½“å¼ºåˆ¶è½¬åŒ–ä¸ºè‡ªå®šä¹‰çš„ç»“æ„ä½“ï¼Œè½¬åŒ–æˆåŠŸè¯´æ˜åº•å±‚ç»“æ„ä½“ç¡®å®å¦‚æˆ‘ä»¬ä¹‹å‰åˆ†æçš„ä¸€æ ·ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> __<span class="title">main_block_desc_0</span> &#123;</span> </span><br><span class="line">    <span class="keyword">size_t</span> reserved;</span><br><span class="line">    <span class="keyword">size_t</span> Block_size;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> __<span class="title">block_impl</span> &#123;</span></span><br><span class="line">    <span class="keyword">void</span> *isa;</span><br><span class="line">    <span class="keyword">int</span> Flags;</span><br><span class="line">    <span class="keyword">int</span> Reserved;</span><br><span class="line">    <span class="keyword">void</span> *FuncPtr;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// æ¨¡ä»¿ç³»ç»Ÿ__main_block_impl_0ç»“æ„ä½“</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> __<span class="title">main_block_impl_0</span> &#123;</span> </span><br><span class="line">    <span class="class"><span class="keyword">struct</span> __<span class="title">block_impl</span> <span class="title">impl</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> __<span class="title">main_block_desc_0</span>* <span class="title">Desc</span>;</span></span><br><span class="line">    <span class="keyword">int</span> age;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span> </span>&#123;</span><br><span class="line">    @autoreleasepool &#123;</span><br><span class="line">        <span class="keyword">int</span> age = <span class="number">10</span>;</span><br><span class="line">        <span class="keyword">void</span>(^block)(<span class="keyword">int</span> ,<span class="keyword">int</span>) = ^(<span class="keyword">int</span> a, <span class="keyword">int</span> b)&#123;</span><br><span class="line">            NSLog(@<span class="string">"this is block,a = %d,b = %d"</span>,a,b);</span><br><span class="line">            NSLog(@<span class="string">"this is block,age = %d"</span>,age);</span><br><span class="line">        &#125;;</span><br><span class="line"><span class="comment">// å°†åº•å±‚çš„ç»“æ„ä½“å¼ºåˆ¶è½¬åŒ–ä¸ºæˆ‘ä»¬è‡ªå·±å†™çš„ç»“æ„ä½“ï¼Œé€šè¿‡æˆ‘ä»¬è‡ªå®šä¹‰çš„ç»“æ„ä½“æ¢å¯»blockåº•å±‚ç»“æ„ä½“</span></span><br><span class="line">        <span class="class"><span class="keyword">struct</span> __<span class="title">main_block_impl_0</span> *<span class="title">blockStruct</span> = (__<span class="title">bridge</span> <span class="title">struct</span> __<span class="title">main_block_impl_0</span> *)<span class="title">block</span>;</span></span><br><span class="line">        block(<span class="number">3</span>,<span class="number">5</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œåï¼Œæ²¡é—®é¢˜ï¼ŒæŸ¥çœ‹ è°ƒç”¨æ ˆåœ°å€ï¼Œå‘ç°åˆ†æçš„ä¹Ÿæ²¡é—®é¢˜ã€‚æ€»ç»“å›¾ï¼š</p>
<img src="/blog/block%E7%9A%84%E6%9C%AC%E8%B4%A8/block%E5%BA%95%E5%B1%82struct%E5%9B%BE.png" class="" title="blockåº•å±‚structå›¾.png">

<h2 id="äºŒã€blockçš„å˜é‡æ•è·"><a href="#äºŒã€blockçš„å˜é‡æ•è·" class="headerlink" title="äºŒã€blockçš„å˜é‡æ•è·"></a>äºŒã€blockçš„å˜é‡æ•è·</h2><p>ä¸ºäº†ä¿è¯blockå†…éƒ¨èƒ½å¤Ÿæ­£å¸¸è®¿é—®å¤–éƒ¨çš„å˜é‡ï¼Œblockæœ‰ä¸€ä¸ªå˜é‡æ•è·æœºåˆ¶ã€‚</p>
<h3 id="1ã€å±€éƒ¨å˜é‡"><a href="#1ã€å±€éƒ¨å˜é‡" class="headerlink" title="1ã€å±€éƒ¨å˜é‡"></a>1ã€å±€éƒ¨å˜é‡</h3><p>autoè‡ªåŠ¨å˜é‡ï¼Œç¦»å¼€ä½œç”¨åŸŸå°±é”€æ¯ï¼Œé€šå¸¸å±€éƒ¨å˜é‡å‰é¢è‡ªåŠ¨æ·»åŠ autoå…³é”®å­—ã€‚è‡ªåŠ¨å˜é‡ä¼šæ•è·åˆ°blockå†…éƒ¨ï¼Œä¹Ÿå°±æ˜¯è¯´blockå†…éƒ¨ä¼šä¸“é—¨æ–°å¢åŠ ä¸€ä¸ªå‚æ•°æ¥å­˜å‚¨å˜é‡çš„å€¼ã€‚<br>autoåªå­˜åœ¨äºå±€éƒ¨å˜é‡ä¸­ï¼Œè®¿é—®æ–¹å¼ä¸ºå€¼ä¼ é€’ï¼Œé€šè¿‡ä¸Šè¿°å¯¹ageå‚æ•°çš„è§£é‡Šæˆ‘ä»¬ä¹Ÿå¯ä»¥ç¡®å®šç¡®å®æ˜¯å€¼ä¼ é€’ã€‚</p>
<h3 id="2ã€staticå˜é‡"><a href="#2ã€staticå˜é‡" class="headerlink" title="2ã€staticå˜é‡"></a>2ã€staticå˜é‡</h3><p>static ä¿®é¥°çš„å˜é‡ä¸ºæŒ‡é’ˆä¼ é€’ï¼ŒåŒæ ·ä¼šè¢«blockæ•è·ã€‚</p>
<p>æ¥ä¸‹æ¥åˆ†åˆ«æ·»åŠ aotuä¿®é¥°çš„å±€éƒ¨å˜é‡å’Œstaticä¿®é¥°çš„å±€éƒ¨å˜é‡ï¼Œé‡çœ‹æºç æ¥çœ‹ä¸€ä¸‹ä»–ä»¬ä¹‹é—´çš„å·®åˆ«ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> a = <span class="number">10</span>;    </span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> b =<span class="number">20</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> (^yhBlock)(<span class="keyword">void</span>) = ^() &#123;</span><br><span class="line">   NSLog(@<span class="string">"blockå†… a = %d,b = %d"</span>, a,b);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">a = <span class="number">1</span>;</span><br><span class="line">b = <span class="number">2</span>;</span><br><span class="line">NSLog(@<span class="string">"block æ‰§è¡Œå‰a = %d,b = %d"</span>, a ,b);</span><br><span class="line">yhBlock();</span><br><span class="line"></span><br><span class="line"><span class="comment">//log:</span></span><br><span class="line"><span class="comment">//2020-06-08 14:32:55.105905+0800 myRuntimeStudy[27860:6464106] block æ‰§è¡Œå‰a = 1,b = 2</span></span><br><span class="line"><span class="comment">//2020-06-08 14:32:55.109104+0800 myRuntimeStudy[27860:6464106] blockå†… a = 10,b = 2</span></span><br></pre></td></tr></table></figure>
<img src="/blog/block%E7%9A%84%E6%9C%AC%E8%B4%A8/block%E5%AF%B9%E9%9D%99%E6%80%81%E5%8F%98%E9%87%8F%E4%B8%8E%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8F%E6%8D%95%E8%8E%B7%E7%9A%84%E5%8C%BA%E5%88%AB.png" class="" title="blockå¯¹é™æ€å˜é‡ä¸å±€éƒ¨å˜é‡æ•è·çš„åŒºåˆ«.png">
<p>ä¸Šè¿°æºç ä¸­å¯ä»¥çœ‹å‡ºï¼Œa,bä¸¤ä¸ªå˜é‡éƒ½æœ‰æ•è·åˆ°blockå†…éƒ¨ã€‚ä½†æ˜¯aä¼ å…¥çš„æ˜¯å€¼ï¼Œè€Œbä¼ å…¥çš„åˆ™æ˜¯åœ°å€ã€‚<br>ä¸ºä»€ä¹ˆä¸¤ç§å˜é‡ä¼šæœ‰è¿™ç§å·®å¼‚å‘¢ï¼Œå› ä¸ºè‡ªåŠ¨å˜é‡å¯èƒ½ä¼šé”€æ¯ï¼Œblockåœ¨æ‰§è¡Œçš„æ—¶å€™æœ‰å¯èƒ½è‡ªåŠ¨å˜é‡å·²ç»è¢«é”€æ¯äº†ï¼Œé‚£ä¹ˆæ­¤æ—¶å¦‚æœå†å»è®¿é—®è¢«é”€æ¯çš„åœ°å€è‚¯å®šä¼šå‘ç”Ÿåå†…å­˜è®¿é—®ï¼Œå› æ­¤å¯¹äºè‡ªåŠ¨å˜é‡ä¸€å®šæ˜¯å€¼ä¼ é€’è€Œä¸å¯èƒ½æ˜¯æŒ‡é’ˆä¼ é€’äº†ã€‚è€Œé™æ€å˜é‡ä¸ä¼šè¢«é”€æ¯ï¼Œæ‰€ä»¥å®Œå…¨å¯ä»¥ä¼ é€’åœ°å€ã€‚è€Œå› ä¸ºä¼ é€’çš„æ˜¯å€¼å¾—åœ°å€ï¼Œæ‰€ä»¥åœ¨blockè°ƒç”¨ä¹‹å‰ä¿®æ”¹åœ°å€ä¸­ä¿å­˜çš„å€¼ï¼Œblockä¸­çš„åœ°å€æ˜¯ä¸ä¼šå˜å¾—ã€‚æ‰€ä»¥å€¼ä¼šéšä¹‹æ”¹å˜ã€‚</p>
<h3 id="3ã€å…¨å±€å˜é‡"><a href="#3ã€å…¨å±€å˜é‡" class="headerlink" title="3ã€å…¨å±€å˜é‡"></a>3ã€å…¨å±€å˜é‡</h3><p>ä¿®æ”¹æˆå¦‚ä¸‹ä»£ç ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> a = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> b =<span class="number">20</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> * argv[])</span> </span>&#123;</span><br><span class="line">    @autoreleasepool &#123;</span><br><span class="line">        <span class="keyword">void</span> (^yhBlock)(<span class="keyword">void</span>) = ^() &#123;</span><br><span class="line">            NSLog(@<span class="string">"blockå†… a = %d,b = %d"</span>, a,b);</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        a = <span class="number">1</span>;</span><br><span class="line">        b = <span class="number">2</span>;</span><br><span class="line">        NSLog(@<span class="string">"block æ‰§è¡Œå‰a = %d,b = %d"</span>, a ,b);</span><br><span class="line">        yhBlock();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> UIApplicationMain(argc, argv, nil, NSStringFromClass([AppDelegate class]));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//2020-06-08 15:04:02.109912+0800 myRuntimeStudy[27975:6478909] block æ‰§è¡Œå‰a = 1,b = 2</span></span><br><span class="line"><span class="comment">// 2020-06-08 15:04:02.127486+0800 myRuntimeStudy[27975:6478909] blockå†… a = 1,b = 2</span></span><br></pre></td></tr></table></figure>
<p>åŒæ ·ç”Ÿæˆc++ä»£ç æŸ¥çœ‹å…¨å±€å˜é‡è°ƒç”¨æ–¹å¼:</p>
<img src="/blog/block%E7%9A%84%E6%9C%AC%E8%B4%A8/block%E5%AF%B9%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F%E5%BC%95%E7%94%A8.png" class="" title="blockå¯¹å…¨å±€å˜é‡å¼•ç”¨.png">
<p>é€šè¿‡ä¸Šè¿°ä»£ç å¯ä»¥å‘ç°ï¼Œ__main_block_imp_0å¹¶æ²¡æœ‰æ·»åŠ ä»»ä½•å˜é‡ï¼Œå› æ­¤blockä¸éœ€è¦æ•è·å…¨å±€å˜é‡ï¼Œå› ä¸ºå…¨å±€å˜é‡æ— è®ºåœ¨å“ªé‡Œéƒ½å¯ä»¥è®¿é—®ã€‚</p>
<img src="/blog/block%E7%9A%84%E6%9C%AC%E8%B4%A8/block%E5%AF%B9%E5%90%84%E7%A7%8D%E5%8F%98%E9%87%8F%E7%9A%84%E5%BC%95%E7%94%A8%E8%A1%A8.png" class="" title="blockå¯¹å„ç§å˜é‡çš„å¼•ç”¨è¡¨.png">
<p>æ€»ç»“ï¼šå±€éƒ¨å˜é‡éƒ½ä¼šè¢«blockæ•è·ï¼Œè‡ªåŠ¨å˜é‡æ˜¯å€¼æ•è·ï¼Œé™æ€å˜é‡ä¸ºåœ°å€æ•è·ã€‚å…¨å±€å˜é‡åˆ™ä¸ä¼šè¢«blockæ•è·</p>
<h3 id="4ã€å®ä¾‹å˜é‡"><a href="#4ã€å®ä¾‹å˜é‡" class="headerlink" title="4ã€å®ä¾‹å˜é‡"></a>4ã€å®ä¾‹å˜é‡</h3><p>æ–°å»ºpersonç±»ï¼Œ</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">@implementation Person</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)test</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">void</span>(^block)(<span class="keyword">void</span>) = ^&#123;</span><br><span class="line">        NSLog(@<span class="string">"%@"</span>,self);</span><br><span class="line">    &#125;;</span><br><span class="line">    block();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (instancetype)initWithName:(NSString *)name</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (self = [super init]) &#123;</span><br><span class="line">        self.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">void</span>) test2</span><br><span class="line">&#123;</span><br><span class="line">    NSLog(@<span class="string">"ç±»æ–¹æ³•test2"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åŒæ ·è½¬åŒ–ä¸ºc++ä»£ç æŸ¥çœ‹å…¶å†…éƒ¨ç»“æ„:</p>
<img src="/blog/block%E7%9A%84%E6%9C%AC%E8%B4%A8/block%E5%AE%9E%E4%BE%8B%E5%8F%98%E9%87%8Fself%E5%BC%95%E7%94%A8%E6%BA%90%E7%A0%81.png" class="" title="blockå®ä¾‹å˜é‡selfå¼•ç”¨æºç .png">
<p>ä¸Šå›¾ä¸­å¯ä»¥å‘ç°ï¼ŒselfåŒæ ·è¢«blockæ•è·ï¼Œæ¥ç€æˆ‘ä»¬æ‰¾åˆ°testæ–¹æ³•å¯ä»¥å‘ç°ï¼Œtestæ–¹æ³•é»˜è®¤ä¼ é€’äº†ä¸¤ä¸ªå‚æ•°selfå’Œ_cmdã€‚è€Œç±»æ–¹æ³•test2ä¹ŸåŒæ ·é»˜è®¤ä¼ é€’äº†ç±»å¯¹è±¡selfå’Œæ–¹æ³•é€‰æ‹©å™¨_cmd.</p>
<p>![ç±»æ–¹æ³•ä¸å®ä¾‹æ–¹æ³•å‚æ•°çš„å¯¹æ¯”.png](blockçš„æœ¬è´¨/ç±»æ–¹æ³•ä¸å®ä¾‹æ–¹æ³•å‚æ•°çš„å¯¹æ¯”.png<br>g)<br>ä¸è®ºå¯¹è±¡æ–¹æ³•è¿˜æ˜¯ç±»æ–¹æ³•éƒ½ä¼šé»˜è®¤å°†selfä½œä¸ºå‚æ•°ä¼ é€’ç»™æ–¹æ³•å†…éƒ¨ï¼Œæ—¢ç„¶æ˜¯ä½œä¸ºå‚æ•°ä¼ å…¥ï¼Œé‚£ä¹ˆselfè‚¯å®šæ˜¯å±€éƒ¨å˜é‡ã€‚ä¸Šé¢è®²åˆ°å±€éƒ¨å˜é‡è‚¯å®šä¼šè¢«blockæ•è·ã€‚</p>
<p>æ¥ä¸‹æ¥çœ‹ä¸‹ï¼Œå¦‚æœåœ¨blockä¸­ä½¿ç”¨æˆå‘˜å˜é‡æˆ–è€…è°ƒç”¨å®ä¾‹çš„å±æ€§ä¼šæœ‰ä»€ä¹ˆä¸åŒçš„ç»“æœï¼š<br>ä¿®æ”¹testæ–¹æ³•ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)test</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">void</span>(^block)(<span class="keyword">void</span>) = ^&#123;</span><br><span class="line">        NSLog(@<span class="string">"%@"</span>,self.name);</span><br><span class="line">        NSLog(@<span class="string">"%@"</span>,self-&gt;_name);</span><br><span class="line">    &#125;;</span><br><span class="line">    block();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>![å±æ€§å’Œå®ä¾‹å˜é‡ä¸åŒè·å–æ–¹å¼å¯¹æ¯”.png](blockçš„æœ¬è´¨/å±æ€§å’Œå®ä¾‹å˜é‡ä¸åŒè·å–æ–¹å¼å¯¹æ¯”.pngï¼‰<br>ä¸Šå›¾ä¸­å¯ä»¥å‘ç°ï¼Œå³ä½¿blockä¸­ä½¿ç”¨çš„æ˜¯å®ä¾‹å¯¹è±¡çš„å±æ€§ï¼Œblockä¸­æ•è·çš„ä»ç„¶æ˜¯å®ä¾‹å¯¹è±¡selfï¼Œå¹¶é€šè¿‡å®ä¾‹å¯¹è±¡é€šè¿‡ä¸åŒçš„æ–¹å¼å»è·å–ä½¿ç”¨åˆ°çš„å±æ€§ã€‚</p>
<h2 id="ä¸‰ã€blockçš„ç±»å‹"><a href="#ä¸‰ã€blockçš„ç±»å‹" class="headerlink" title="ä¸‰ã€blockçš„ç±»å‹"></a>ä¸‰ã€blockçš„ç±»å‹</h2><h3 id="1ã€blockå¯¹è±¡æ˜¯ä»€ä¹ˆç±»å‹å‘¢ï¼Ÿ"><a href="#1ã€blockå¯¹è±¡æ˜¯ä»€ä¹ˆç±»å‹å‘¢ï¼Ÿ" class="headerlink" title="1ã€blockå¯¹è±¡æ˜¯ä»€ä¹ˆç±»å‹å‘¢ï¼Ÿ"></a>1ã€blockå¯¹è±¡æ˜¯ä»€ä¹ˆç±»å‹å‘¢ï¼Ÿ</h3><p>é¦–å…ˆçŸ¥é“äº†block æŒ‡é’ˆæ˜¯ æŒ‡å‘_NSConcreteStackBlockç±»å¯¹è±¡åœ°å€çš„ã€‚é‚£ä¹ˆblockæ˜¯å¦å°±æ˜¯_NSConcreteStackBlockç±»å‹çš„å‘¢ï¼Ÿ</p>
<p>é€šè¿‡ä»£ç ç”¨classæ–¹æ³•æˆ–è€…isaæŒ‡é’ˆæŸ¥çœ‹å…·ä½“ç±»å‹ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> * argv[])</span> </span>&#123;</span><br><span class="line">    @autoreleasepool &#123;</span><br><span class="line">        <span class="comment">// __NSGlobalBlock__ : __NSGlobalBlock : NSBlock : NSObject</span></span><br><span class="line">        <span class="keyword">void</span> (^block)(<span class="keyword">void</span>) = ^&#123;</span><br><span class="line">            NSLog(@<span class="string">"Hello"</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">                </span><br><span class="line">        NSLog(@<span class="string">"%@"</span>, [block class]);</span><br><span class="line">        NSLog(@<span class="string">"%@"</span>, [[block class] superclass]);</span><br><span class="line">        NSLog(@<span class="string">"%@"</span>, [[[block class] superclass] superclass]);</span><br><span class="line">        NSLog(@<span class="string">"%@"</span>, [[[[block class] superclass] superclass] superclass]);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> UIApplicationMain(argc, argv, nil, NSStringFromClass([AppDelegate class]));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 2020-06-08 17:20:23.811767+0800 myRuntimeStudy[28481:6550993] __NSGlobalBlock__</span></span><br><span class="line"><span class="comment">// 2020-06-08 17:20:23.816262+0800 myRuntimeStudy[28481:6550993] __NSGlobalBlock</span></span><br><span class="line"><span class="comment">// 2020-06-08 17:20:23.816409+0800 myRuntimeStudy[28481:6550993] NSBlock</span></span><br><span class="line"><span class="comment">// 2020-06-08 17:20:23.816558+0800 myRuntimeStudy[28481:6550993] NSObject</span></span><br></pre></td></tr></table></figure>
<p>ä»ä¸Šè¿°æ‰“å°å†…å®¹å¯ä»¥çœ‹å‡ºblockæœ€ç»ˆéƒ½æ˜¯ç»§æ‰¿è‡ªNSBlockç±»å‹ï¼Œè€ŒNSBlockç»§æ‰¿äºNSObjcetã€‚é‚£ä¹ˆblockå…¶ä¸­çš„isaæŒ‡é’ˆå…¶å®æ˜¯æ¥è‡ªNSObjectä¸­çš„ã€‚è¿™ä¹Ÿæ›´åŠ å°è¯äº†blockçš„æœ¬è´¨å…¶å®å°±æ˜¯OCå¯¹è±¡.</p>
<h3 id="2ã€blockçš„ä¸‰ç§ç±»å‹"><a href="#2ã€blockçš„ä¸‰ç§ç±»å‹" class="headerlink" title="2ã€blockçš„ä¸‰ç§ç±»å‹"></a>2ã€blockçš„ä¸‰ç§ç±»å‹</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">__NSGlobalBlock__ ï¼ˆ _NSConcreteGlobalBlock ï¼‰</span><br><span class="line">__NSStackBlock__ ï¼ˆ _NSConcreteStackBlock ï¼‰</span><br><span class="line">__NSMallocBlock__ ï¼ˆ _NSConcreteMallocBlock ï¼‰</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡ä»£ç æŸ¥çœ‹ä¸€ä¸‹blockåœ¨ä»€ä¹ˆæƒ…å†µä¸‹å…¶ç±»å‹ä¼šå„ä¸ç›¸åŒ:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span> </span>&#123;</span><br><span class="line">    @autoreleasepool &#123;</span><br><span class="line">        <span class="comment">// 1. å†…éƒ¨æ²¡æœ‰è°ƒç”¨å¤–éƒ¨å˜é‡çš„block</span></span><br><span class="line">        <span class="keyword">void</span> (^block1)(<span class="keyword">void</span>) = ^&#123;</span><br><span class="line">            NSLog(@<span class="string">"Hello"</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">// 2. å†…éƒ¨è°ƒç”¨å¤–éƒ¨å˜é‡çš„block</span></span><br><span class="line">        <span class="keyword">int</span> a = <span class="number">10</span>;</span><br><span class="line">        <span class="keyword">void</span> (^block2)(<span class="keyword">void</span>) = ^&#123;</span><br><span class="line">            NSLog(@<span class="string">"Hello - %d"</span>,a);</span><br><span class="line">        &#125;;</span><br><span class="line">       <span class="comment">// 3. ç›´æ¥è°ƒç”¨çš„blockçš„class</span></span><br><span class="line">        NSLog(@<span class="string">"%@ %@ %@"</span>, [block1 class], [block2 class], [^&#123;</span><br><span class="line">            NSLog(@<span class="string">"%d"</span>,a);</span><br><span class="line">        &#125; class]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡æ‰“å°å†…å®¹ç¡®å®å¯ä»¥å‘ç°blockçš„ä¸‰ç§ç±»å‹</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__NSGlobalBlock__   __NSMallocBlock__   __NSStackBlock__</span><br></pre></td></tr></table></figure>
<p>æ³¨ï¼šä¸Šè¿°ä»£ç è½¬åŒ–ä¸ºc++ä»£ç æŸ¥çœ‹æºç æ—¶å´å‘ç°blockçš„ç±»å‹ä¸æ‰“å°å‡ºæ¥çš„ç±»å‹ä¸ä¸€æ ·ï¼Œc++æºç ä¸­ä¸‰ä¸ªblockçš„isaæŒ‡é’ˆå…¨éƒ¨éƒ½æŒ‡å‘_NSConcreteStackBlockç±»å‹åœ°å€ã€‚<br>æˆ‘ä»¬å¯ä»¥çŒœæµ‹runtimeè¿è¡Œæ—¶è¿‡ç¨‹ä¸­ä¹Ÿè®¸å¯¹ç±»å‹è¿›è¡Œäº†è½¬å˜ã€‚æœ€ç»ˆç±»å‹å½“ç„¶ä»¥runtimeè¿è¡Œæ—¶ç±»å‹ä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰“å°å‡ºçš„ç±»å‹ä¸ºå‡†ã€‚</p>
<h3 id="3ã€blockåœ¨å†…å­˜ä¸­çš„å­˜å‚¨"><a href="#3ã€blockåœ¨å†…å­˜ä¸­çš„å­˜å‚¨" class="headerlink" title="3ã€blockåœ¨å†…å­˜ä¸­çš„å­˜å‚¨"></a>3ã€blockåœ¨å†…å­˜ä¸­çš„å­˜å‚¨</h3><p>é€šè¿‡ä¸‹é¢ä¸€å¼ å›¾çœ‹ä¸€ä¸‹ä¸åŒblockçš„å­˜æ”¾åŒºåŸŸï¼š</p>
<img src="/blog/block%E7%9A%84%E6%9C%AC%E8%B4%A8/%E4%B8%8D%E5%90%8Cblock%E5%9C%A8%E5%86%85%E5%AD%98%E4%B8%AD%E7%9A%84%E5%AD%98%E6%94%BE%E5%8C%BA%E5%9F%9F.png" class="" title="blockä¸åŒç±»å‹çš„ç‰¹ç‚¹ä¸å­˜å‚¨åŒºåŸŸå¯¹æ¯”.png">

<p>ä¸Šå›¾ä¸­å¯ä»¥å‘ç°ï¼Œæ ¹æ®blockçš„ç±»å‹ä¸åŒï¼Œblockå­˜æ”¾åœ¨ä¸åŒçš„åŒºåŸŸä¸­ã€‚</p>
<p>æ•°æ®æ®µä¸­çš„<strong>NSGlobalBlock</strong>ç›´åˆ°ç¨‹åºç»“æŸæ‰ä¼šè¢«å›æ”¶ï¼Œä¸è¿‡æˆ‘ä»¬å¾ˆå°‘ä½¿ç”¨åˆ°<strong>NSGlobalBlock</strong>ç±»å‹çš„blockï¼Œå› ä¸ºè¿™æ ·ä½¿ç”¨blockå¹¶æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰ã€‚</p>
<p><strong>NSStackBlock</strong>ç±»å‹çš„blockå­˜æ”¾åœ¨æ ˆä¸­ï¼Œæˆ‘ä»¬çŸ¥é“æ ˆä¸­çš„å†…å­˜ç”±ç³»ç»Ÿè‡ªåŠ¨åˆ†é…å’Œé‡Šæ”¾ï¼Œä½œç”¨åŸŸæ‰§è¡Œå®Œæ¯•ä¹‹åå°±ä¼šè¢«ç«‹å³é‡Šæ”¾ï¼Œè€Œåœ¨ç›¸åŒçš„ä½œç”¨åŸŸä¸­å®šä¹‰blockå¹¶ä¸”è°ƒç”¨blockä¼¼ä¹ä¹Ÿå¤šæ­¤ä¸€ä¸¾ã€‚</p>
<p><strong>NSMallocBlock</strong>æ˜¯åœ¨å¹³æ—¶ç¼–ç è¿‡ç¨‹ä¸­æœ€å¸¸ä½¿ç”¨åˆ°çš„ã€‚å­˜æ”¾åœ¨å †ä¸­éœ€è¦æˆ‘ä»¬è‡ªå·±è¿›è¡Œå†…å­˜ç®¡ç†ã€‚</p>
<h3 id="4ã€blockæ˜¯å¦‚ä½•å®šä¹‰å…¶ç±»å‹"><a href="#4ã€blockæ˜¯å¦‚ä½•å®šä¹‰å…¶ç±»å‹" class="headerlink" title="4ã€blockæ˜¯å¦‚ä½•å®šä¹‰å…¶ç±»å‹"></a>4ã€blockæ˜¯å¦‚ä½•å®šä¹‰å…¶ç±»å‹</h3><p>blockæ˜¯ä¾æ®ä»€ä¹ˆæ¥ä¸ºblockå®šä¹‰ä¸åŒçš„ç±»å‹å¹¶åˆ†é…åœ¨ä¸åŒçš„ç©ºé—´å‘¢ï¼Ÿ<br>é¦–å…ˆçœ‹ä¸‹é¢ä¸€å¼ å›¾</p>
<img src="/blog/block%E7%9A%84%E6%9C%AC%E8%B4%A8/block%E4%B8%8D%E5%90%8C%E7%B1%BB%E5%9E%8B%E7%9A%84%E7%89%B9%E7%82%B9%E4%B8%8E%E5%AD%98%E5%82%A8%E5%8C%BA%E5%9F%9F%E5%AF%B9%E6%AF%94.png" class="" title="blockä¸åŒç±»å‹çš„ç‰¹ç‚¹ä¸å­˜å‚¨åŒºåŸŸå¯¹æ¯”.png">
<p>æ¥ç€æˆ‘ä»¬ä½¿ç”¨ä»£ç éªŒè¯ä¸Šè¿°é—®é¢˜ï¼Œé¦–å…ˆå…³é—­ARCå›åˆ°MRCç¯å¢ƒä¸‹ï¼Œå› ä¸ºARCä¼šå¸®åŠ©æˆ‘ä»¬åšå¾ˆå¤šäº‹æƒ…ï¼Œå¯èƒ½ä¼šå½±å“æˆ‘ä»¬çš„è§‚å¯Ÿã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> * argv[])</span> </span>&#123;</span><br><span class="line">    @autoreleasepool &#123;</span><br><span class="line">     <span class="comment">// Globalï¼šæ²¡æœ‰è®¿é—®autoå˜é‡ï¼š__NSGlobalBlock__</span></span><br><span class="line">        <span class="keyword">void</span> (^block1)(<span class="keyword">void</span>) = ^&#123;</span><br><span class="line">            NSLog(@<span class="string">"block1---------"</span>);</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="comment">// Stackï¼šè®¿é—®äº†autoå˜é‡ï¼š __NSStackBlock__</span></span><br><span class="line">            <span class="keyword">int</span> a = <span class="number">10</span>;</span><br><span class="line">            <span class="keyword">void</span> (^block2)(<span class="keyword">void</span>) = ^&#123;</span><br><span class="line">                NSLog(@<span class="string">"block2---------%d"</span>, a);</span><br><span class="line">            &#125;;</span><br><span class="line">            NSLog(@<span class="string">"%@ %@"</span>, [block1 class], [block2 class]);</span><br><span class="line">            <span class="comment">// __NSStackBlock__è°ƒç”¨copy ï¼š __NSMallocBlock__</span></span><br><span class="line">            NSLog(@<span class="string">"%@"</span>, [[block2 copy] class]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> UIApplicationMain(argc, argv, nil, NSStringFromClass([AppDelegate class]));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//log:</span></span><br><span class="line"><span class="comment">//2020-06-08 18:08:24.562043+0800 myRuntimeStudy[28705:6574673] __NSGlobalBlock__ __NSStackBlock__</span></span><br><span class="line"><span class="comment">// 2020-06-08 18:08:24.562781+0800 myRuntimeStudy[28705:6574673] __NSMallocBlock__</span></span><br></pre></td></tr></table></figure>
<p>é€šè¿‡æ‰“å°çš„å†…å®¹å¯ä»¥å‘ç°æ­£å¦‚ä¸Šå›¾ä¸­æ‰€ç¤ºã€‚<br>æ²¡æœ‰è®¿é—®autoå˜é‡çš„blockæ˜¯<strong>NSGlobalBlock</strong>ç±»å‹çš„ï¼Œå­˜æ”¾åœ¨æ•°æ®æ®µä¸­ã€‚<br>è®¿é—®äº†autoå˜é‡çš„blockæ˜¯<strong>NSStackBlock</strong>ç±»å‹çš„ï¼Œå­˜æ”¾åœ¨æ ˆä¸­ã€‚<br><strong>NSStackBlock</strong>ç±»å‹çš„blockè°ƒç”¨copyæˆä¸º<strong>NSMallocBlock</strong>ç±»å‹å¹¶è¢«å¤åˆ¶å­˜æ”¾åœ¨å †ä¸­ã€‚</p>
<p><strong>NSGlobalBlock</strong>ç±»å‹çš„æˆ‘ä»¬å¾ˆå°‘ä½¿ç”¨åˆ°ï¼Œå› ä¸ºå¦‚æœä¸éœ€è¦è®¿é—®å¤–ç•Œçš„å˜é‡ï¼Œç›´æ¥é€šè¿‡å‡½æ•°å®ç°å°±å¯ä»¥äº†ï¼Œä¸éœ€è¦ä½¿ç”¨blockã€‚<br>ä½†æ˜¯<strong>NSStackBlock</strong>è®¿é—®äº†aotuå˜é‡ï¼Œå¹¶ä¸”æ˜¯å­˜æ”¾åœ¨æ ˆä¸­çš„ï¼Œä¸Šé¢æåˆ°è¿‡ï¼Œæ ˆä¸­çš„ä»£ç åœ¨ä½œç”¨åŸŸç»“æŸä¹‹åå†…å­˜å°±ä¼šè¢«é”€æ¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¾ˆæœ‰å¯èƒ½blockå†…å­˜é”€æ¯ä¹‹åæ‰å»è°ƒç”¨ä»–ï¼Œé‚£æ ·å°±ä¼šå‘ç”Ÿé—®é¢˜.<br>é€šè¿‡ä¸‹é¢ä»£ç å¯ä»¥è¯å®è¿™ä¸ªé—®é¢˜ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> (^block)(<span class="keyword">void</span>);</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// __NSStackBlock__</span></span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">10</span>;</span><br><span class="line">    block = ^&#123;</span><br><span class="line">        NSLog(@<span class="string">"block---------%d"</span>, a);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> * argv[])</span> </span>&#123;</span><br><span class="line">    @autoreleasepool &#123;</span><br><span class="line">        </span><br><span class="line">      test();</span><br><span class="line">      block();</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">return</span> UIApplicationMain(argc, argv, nil, NSStringFromClass([AppDelegate class]));</span><br><span class="line">   </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//log:</span></span><br><span class="line"><span class="comment">// 2020-06-08 18:13:35.889505+0800 myRuntimeStudy[28727:6578019] block----------412841048</span></span><br></pre></td></tr></table></figure>
<p>açš„å€¼å˜ä¸ºäº†ä¸å¯æ§çš„ä¸€ä¸ªæ•°å­—ã€‚ä¸ºä»€ä¹ˆä¼šå‘ç”Ÿè¿™ç§æƒ…å†µå‘¢ï¼Ÿå› ä¸ºä¸Šè¿°ä»£ç ä¸­åˆ›å»ºçš„blockæ˜¯<strong>NSStackBlock</strong>ç±»å‹çš„ï¼Œå› æ­¤blockæ˜¯å­˜å‚¨åœ¨æ ˆä¸­çš„ï¼Œé‚£ä¹ˆå½“testå‡½æ•°æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œæ ˆå†…å­˜ä¸­blockæ‰€å ç”¨çš„å†…å­˜å·²ç»è¢«ç³»ç»Ÿå›æ”¶ï¼Œå› æ­¤å°±æœ‰å¯èƒ½å‡ºç°ä¹±å¾—æ•°æ®ã€‚</p>
<p>æŸ¥çœ‹å…¶c++ä»£ç å¯ä»¥æ›´æ¸…æ¥šçš„ç†è§£ã€‚</p>
<img src="/blog/block%E7%9A%84%E6%9C%AC%E8%B4%A8/MRC%E4%B8%8Bblock%E5%BC%95%E7%94%A8%E6%88%90%E5%91%98%E5%8F%98%E9%87%8F%E9%87%8A%E6%94%BE%E5%BC%95%E8%B5%B7%E7%9A%84%E6%95%B0%E6%8D%AE%E9%94%99%E4%B9%B1.png" class="" title="MRCä¸‹blockå¼•ç”¨æˆå‘˜å˜é‡é‡Šæ”¾å¼•èµ·çš„æ•°æ®é”™ä¹±.png">

<p>ä¸ºäº†é¿å…è¿™ç§æƒ…å†µå‘ç”Ÿï¼Œå¯ä»¥é€šè¿‡copyå°†<strong>NSStackBlock</strong>ç±»å‹çš„blockè½¬åŒ–ä¸º<strong>NSMallocBlock</strong>ç±»å‹çš„blockï¼Œå°†blockå­˜å‚¨åœ¨å †ä¸­ï¼Œä»¥ä¸‹æ˜¯ä¿®æ”¹åçš„ä»£ç ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> (^block)(<span class="keyword">void</span>);</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// __NSStackBlock__ è°ƒç”¨copy è½¬åŒ–ä¸º__NSMallocBlock__</span></span><br><span class="line">    <span class="keyword">int</span> age = <span class="number">10</span>;</span><br><span class="line">    block = [^&#123;</span><br><span class="line">        NSLog(@<span class="string">"block---------%d"</span>, age);</span><br><span class="line">    &#125; copy];</span><br><span class="line">    [block <span class="built_in">release</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ­¤æ—¶åœ¨æ‰“å°å°±ä¼šå‘ç°æ•°æ®æ­£ç¡®.<br>é‚£ä¹ˆå…¶ä»–ç±»å‹çš„blockè°ƒç”¨copyä¼šæ”¹å˜blockç±»å‹å—ï¼Ÿä¸‹é¢è¡¨æ ¼å·²ç»å±•ç¤ºçš„å¾ˆæ¸…æ™°äº†ã€‚</p>
<img src="/blog/block%E7%9A%84%E6%9C%AC%E8%B4%A8/MRC%E4%B8%8Bcopy%E6%93%8D%E4%BD%9C%E5%AF%B9block%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%BD%B1%E5%93%8D.png" class="" title="MRCä¸‹copyæ“ä½œå¯¹blockç±»å‹çš„å½±å“.png">
<p>æ‰€ä»¥åœ¨å¹³æ—¶å¼€å‘è¿‡ç¨‹ä¸­MRCç¯å¢ƒä¸‹ç»å¸¸éœ€è¦ä½¿ç”¨copyæ¥ä¿å­˜blockï¼Œå°†æ ˆä¸Šçš„blockæ‹·è´åˆ°å †ä¸­ï¼Œå³ä½¿æ ˆä¸Šçš„blockè¢«é”€æ¯ï¼Œå †ä¸Šçš„blockä¹Ÿä¸ä¼šè¢«é”€æ¯ï¼Œéœ€è¦æˆ‘ä»¬è‡ªå·±è°ƒç”¨releaseæ“ä½œæ¥é”€æ¯ã€‚è€Œåœ¨ARCç¯å¢ƒä¸‹ç³»ç»Ÿä¼šè‡ªåŠ¨è°ƒç”¨copyæ“ä½œï¼Œä½¿blockä¸ä¼šè¢«é”€æ¯ã€‚</p>
<p>5ã€ARCå¸®æˆ‘ä»¬åšäº†ä»€ä¹ˆ<br>åœ¨ARCç¯å¢ƒä¸‹ï¼Œç¼–è¯‘å™¨ä¼šæ ¹æ®æƒ…å†µè‡ªåŠ¨å°†æ ˆä¸Šçš„blockè¿›è¡Œä¸€æ¬¡copyæ“ä½œï¼Œå°†blockå¤åˆ¶åˆ°å †ä¸Šã€‚<br>ä»€ä¹ˆæƒ…å†µä¸‹ARCä¼šè‡ªåŠ¨å°†blockè¿›è¡Œä¸€æ¬¡copyæ“ä½œï¼Ÿ</p>
<h4 id="aã€blockä½œä¸ºå‡½æ•°è¿”å›å€¼æ—¶"><a href="#aã€blockä½œä¸ºå‡½æ•°è¿”å›å€¼æ—¶" class="headerlink" title="aã€blockä½œä¸ºå‡½æ•°è¿”å›å€¼æ—¶"></a>aã€blockä½œä¸ºå‡½æ•°è¿”å›å€¼æ—¶</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">void</span> <span class="params">(^Block)</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"><span class="function">Block <span class="title">myblock</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">10</span>;</span><br><span class="line">    <span class="comment">// ä¸Šæ–‡æåˆ°è¿‡ï¼Œblockä¸­è®¿é—®äº†autoå˜é‡ï¼Œæ­¤æ—¶blockç±»å‹åº”ä¸º__NSStackBlock__</span></span><br><span class="line">    Block block = ^&#123;</span><br><span class="line">        NSLog(@<span class="string">"---------%d"</span>, a);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> block;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> * argv[])</span> </span>&#123;</span><br><span class="line">    @autoreleasepool &#123;</span><br><span class="line">        </span><br><span class="line">    Block block = myblock();</span><br><span class="line">    block();</span><br><span class="line">    <span class="comment">// æ‰“å°blockç±»å‹ä¸º __NSMallocBlock__</span></span><br><span class="line">    NSLog(@<span class="string">"%@"</span>,[block class]);</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">return</span> UIApplicationMain(argc, argv, nil, NSStringFromClass([AppDelegate class]));</span><br><span class="line">   </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//log:</span></span><br><span class="line"><span class="comment">// 2020-06-08 18:23:05.118309+0800 myRuntimeStudy[28809:6585087] ---------10</span></span><br><span class="line"><span class="comment">// 2020-06-08 18:23:05.119251+0800 myRuntimeStudy[28809:6585087] __NSMallocBlock__</span></span><br></pre></td></tr></table></figure>
<p>ä¸Šè¿°ä»£ç  åœ¨MRCç¯å¢ƒä¸‹ä¼šå´©æºƒåœ¨ï¼ŒæŸ¥çœ‹è°ƒç”¨æ ˆåœ¨msgsend ï¼Œ[block class]å¤„å´©æºƒã€‚åœ¨ARCä¸‹è¿˜å¯ä»¥æ‰“å°å‡ºäº‰å–çš„å€¼ã€‚</p>
<p>æ ¹æ®ä¸Šæ–‡ï¼Œå¦‚æœåœ¨blockä¸­è®¿é—®äº†autoå˜é‡æ—¶ï¼Œblockçš„ç±»å‹ä¸º<strong>NSStackBlock</strong>ï¼Œä¸Šé¢æ‰“å°å†…å®¹å‘ç°blcokä¸º<strong>NSMallocBlock</strong>ç±»å‹çš„ï¼Œå¹¶ä¸”å¯ä»¥æ­£å¸¸æ‰“å°å‡ºaçš„å€¼ï¼Œè¯´æ˜blockå†…å­˜å¹¶æ²¡æœ‰è¢«é”€æ¯ã€‚</p>
<p>ä¸Šé¢æåˆ°è¿‡ï¼Œblockè¿›è¡Œcopyæ“ä½œä¼šè½¬åŒ–ä¸º<strong>NSMallocBlock</strong>ç±»å‹ï¼Œæ¥è®²blockå¤åˆ¶åˆ°å †ä¸­ï¼Œé‚£ä¹ˆè¯´æ˜RACåœ¨ blockä½œä¸ºå‡½æ•°è¿”å›å€¼æ—¶ä¼šè‡ªåŠ¨å¸®åŠ©æˆ‘ä»¬å¯¹blockè¿›è¡Œcopyæ“ä½œï¼Œä»¥ä¿å­˜blockï¼Œå¹¶åœ¨é€‚å½“çš„åœ°æ–¹è¿›è¡Œreleaseæ“ä½œã€‚</p>
<h4 id="bã€å°†blockèµ‹å€¼ç»™-strongæŒ‡é’ˆæ—¶"><a href="#bã€å°†blockèµ‹å€¼ç»™-strongæŒ‡é’ˆæ—¶" class="headerlink" title="bã€å°†blockèµ‹å€¼ç»™__strongæŒ‡é’ˆæ—¶"></a>bã€å°†blockèµ‹å€¼ç»™__strongæŒ‡é’ˆæ—¶</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> * argv[])</span> </span>&#123;</span><br><span class="line">    @autoreleasepool &#123;</span><br><span class="line">    <span class="comment">// blockå†…æ²¡æœ‰è®¿é—®autoå˜é‡</span></span><br><span class="line">          Block block = ^&#123;</span><br><span class="line">              NSLog(@<span class="string">"block---------"</span>);</span><br><span class="line">          &#125;;</span><br><span class="line">          NSLog(@<span class="string">"%@"</span>,[block class]);</span><br><span class="line">        </span><br><span class="line">          <span class="keyword">int</span> a = <span class="number">10</span>;</span><br><span class="line">          <span class="comment">// blockå†…è®¿é—®äº†autoå˜é‡ï¼Œä½†æ²¡æœ‰èµ‹å€¼ç»™__strongæŒ‡é’ˆ</span></span><br><span class="line">          NSLog(@<span class="string">"%@"</span>,[^&#123;</span><br><span class="line">              NSLog(@<span class="string">"block1---------%d"</span>, a);</span><br><span class="line">          &#125; class]);</span><br><span class="line">        </span><br><span class="line">          <span class="comment">// blockèµ‹å€¼ç»™__strongæŒ‡é’ˆ</span></span><br><span class="line">          Block block2 = ^&#123;</span><br><span class="line">            NSLog(@<span class="string">"block2---------%d"</span>, a);</span><br><span class="line">          &#125;;</span><br><span class="line">        </span><br><span class="line">          NSLog(@<span class="string">"block2 class = %@"</span>,[block2 class]);</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">return</span> UIApplicationMain(argc, argv, nil, NSStringFromClass([AppDelegate class]));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//log:</span></span><br><span class="line"><span class="comment">// 2020-06-08 18:40:03.586427+0800 myRuntimeStudy[28902:6594783] __NSGlobalBlock__</span></span><br><span class="line"><span class="comment">// 2020-06-08 18:40:03.587368+0800 myRuntimeStudy[28902:6594783] __NSStackBlock__</span></span><br><span class="line"><span class="comment">// 2020-06-08 18:40:03.587501+0800 myRuntimeStudy[28902:6594783] block2 class = __NSMallocBlock__</span></span><br></pre></td></tr></table></figure>



<h4 id="cã€blockä½œä¸ºCocoa-APIä¸­æ–¹æ³•åå«æœ‰usingBlockçš„æ–¹æ³•å‚æ•°æ—¶"><a href="#cã€blockä½œä¸ºCocoa-APIä¸­æ–¹æ³•åå«æœ‰usingBlockçš„æ–¹æ³•å‚æ•°æ—¶" class="headerlink" title="cã€blockä½œä¸ºCocoa APIä¸­æ–¹æ³•åå«æœ‰usingBlockçš„æ–¹æ³•å‚æ•°æ—¶"></a>cã€blockä½œä¸ºCocoa APIä¸­æ–¹æ³•åå«æœ‰usingBlockçš„æ–¹æ³•å‚æ•°æ—¶</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">NSArray *<span class="built_in">array</span> = @[];</span><br><span class="line">[<span class="built_in">array</span> enumerateObjectsUsingBlock:^(id  _Nonnull obj, NSUInteger idx, BOOL * _Nonnull <span class="built_in">stop</span>) &#123;</span><br><span class="line">            </span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>

<h4 id="dã€blockä½œä¸ºGCD-APIçš„æ–¹æ³•å‚æ•°æ—¶"><a href="#dã€blockä½œä¸ºGCD-APIçš„æ–¹æ³•å‚æ•°æ—¶" class="headerlink" title="dã€blockä½œä¸ºGCD APIçš„æ–¹æ³•å‚æ•°æ—¶"></a>dã€blockä½œä¸ºGCD APIçš„æ–¹æ³•å‚æ•°æ—¶</h4><p>ä¾‹å¦‚ï¼šGDCçš„ä¸€æ¬¡æ€§å‡½æ•°æˆ–å»¶è¿Ÿæ‰§è¡Œçš„å‡½æ•°ï¼Œæ‰§è¡Œå®Œblockæ“ä½œä¹‹åç³»ç»Ÿæ‰ä¼šå¯¹blockè¿›è¡Œreleaseæ“ä½œ</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">dispatch_once_t</span> onceToken;</span><br><span class="line">dispatch_once(&amp;onceToken, ^&#123;</span><br><span class="line">            </span><br><span class="line">&#125;);        </span><br><span class="line">dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (<span class="keyword">int64_t</span>)(<span class="number">1.0</span> * NSEC_PER_SEC)), dispatch_get_main_queue(), ^&#123;</span><br><span class="line">            </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="å››ã€blockå£°æ˜å†™æ³•"><a href="#å››ã€blockå£°æ˜å†™æ³•" class="headerlink" title="å››ã€blockå£°æ˜å†™æ³•"></a>å››ã€blockå£°æ˜å†™æ³•</h2><p>é€šè¿‡ä¸Šé¢å¯¹MRCåŠARCç¯å¢ƒä¸‹blockçš„ä¸åŒç±»å‹çš„åˆ†æï¼Œæ€»ç»“å‡ºä¸åŒç¯å¢ƒä¸‹blockå±æ€§å»ºè®®å†™æ³•ã€‚<br>MRCä¸‹blockå±æ€§çš„å»ºè®®å†™æ³•</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@property (copy, nonatomic) <span class="keyword">void</span> (^block)(<span class="keyword">void</span>);</span><br></pre></td></tr></table></figure>
<p>ARCä¸‹blockå±æ€§çš„å»ºè®®å†™æ³•</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@property (strong, nonatomic) <span class="keyword">void</span> (^block)(<span class="keyword">void</span>);</span><br><span class="line">@property (copy, nonatomic) <span class="keyword">void</span> (^block)(<span class="keyword">void</span>);</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šä¸»è¦æ˜¯å­¦ä¹ ç¬”è®°ï¼Œä¸»è¦æ¥è‡ªï¼š<a href="https://juejin.im/post/5b0181e15188254270643e88" target="_blank" rel="noopener">https://juejin.im/post/5b0181e15188254270643e88</a></p>
<p><a href="https://yuxiang.ren/2019/04/16/Block/" target="_blank" rel="noopener">https://yuxiang.ren/2019/04/16/Block/</a></p>

      
       <hr><span style="font-style: italic;color: gray;"> è½¬è½½è¯·æ³¨æ˜æ¥æºï¼Œæ¬¢è¿å¯¹æ–‡ç« ä¸­çš„å¼•ç”¨æ¥æºè¿›è¡Œè€ƒè¯ï¼Œæ¬¢è¿æŒ‡å‡ºä»»ä½•æœ‰é”™è¯¯æˆ–ä¸å¤Ÿæ¸…æ™°çš„è¡¨è¾¾ã€‚å¯ä»¥åœ¨ä¸‹é¢è¯„è®ºåŒºè¯„è®ºï¼Œä¹Ÿå¯ä»¥é‚®ä»¶è‡³ jaytp@qq.com </span>
    </div>
</article>


<p>
    <a  class="dashang" onclick="dashangToggle()">ğŸ’°</a>
</p>






    




    </div>
    <div class="copyright">
        <p class="footer-entry">
    Â©2016-2020 Yelog
</p>
<p class="footer-entry">Built with <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/yelog/hexo-theme-3-hexo" target="_blank">3-hexo</a> theme</p>

    </div>
    <div class="full-toc">
        <button class="full" data-title="åˆ‡æ¢å…¨å± å¿«æ·é”® s"><span class="min "></span></button>
<a class="" id="rocket" ></a>

    </div>
</div>

<div class="hide_box" onclick="dashangToggle()"></div>
<div class="shang_box">
    <a class="shang_close"  onclick="dashangToggle()">Ã—</a>
    <div class="shang_tit">
        <p>Help us with donation</p>
    </div>
    <div class="shang_payimg">
        <div class="pay_img">
            <img src="/blog/img/alipay.jpg" class="alipay" title="æ‰«ç æ”¯æŒ">
            <img src="/blog/img/weixin.jpg" class="weixin" title="æ‰«ç æ”¯æŒ">
        </div>
    </div>
    <div class="shang_payselect">
        <span><label><input type="radio" name="pay" checked value="alipay">alipay</label></span><span><label><input type="radio" name="pay" value="weixin">weixin</label></span>
    </div>
</div>


</body>
<script src="/blog/js/jquery.pjax.js?v=1.1.0" ></script>

<script src="/blog/js/script.js?v=1.1.0" ></script>
<script>
    var img_resize = 'default';
    function initArticle() {
        /*æ¸²æŸ“å¯¹åº”çš„è¡¨æ ¼æ ·å¼*/
        
            $("#post .pjax table").addClass("green_title");
        

        /*æ¸²æŸ“æ‰“èµæ ·å¼*/
        
        $("input[name=pay]").on("click", function () {
            if($("input[name=pay]:checked").val()=="weixin"){
                $(".shang_box .shang_payimg .pay_img").addClass("weixin_img");
            } else {
                $(".shang_box .shang_payimg .pay_img").removeClass("weixin_img");
            }
        })
        

        /*é«˜äº®ä»£ç å—è¡Œå·*/
        

        /*è®¿é—®æ•°é‡*/
        
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js");
        

        /*ä»£ç é«˜äº®ï¼Œè¡Œå·å¯¹é½*/
        $('.pre-numbering').css('line-height',$('.has-numbering').css('line-height'));

        
        
    }

    /*æ‰“èµé¡µé¢éšè—ä¸å±•ç¤º*/
    
    function dashangToggle() {
        $(".shang_box").fadeToggle();
        $(".hide_box").fadeToggle();
    }
    

</script>

<!--åŠ å…¥è¡Œå·çš„é«˜äº®ä»£ç å—æ ·å¼-->

<!--è‡ªå®šä¹‰æ ·å¼è®¾ç½®-->
<style>
    
    
    .nav {
        width: 542px;
    }
    .nav.fullscreen {
        margin-left: -542px;
    }
    .nav-left {
        width: 120px;
    }
    
    
    @media screen and (max-width: 1468px) {
        .nav {
            width: 492px;
        }
        .nav.fullscreen {
            margin-left: -492px;
        }
        .nav-left {
            width: 100px;
        }
    }
    
    
    @media screen and (max-width: 1024px) {
        .nav {
            width: 492px;
            margin-left: -492px
        }
        .nav.fullscreen {
            margin-left: 0;
        }
    }
    
    @media screen and (max-width: 426px) {
        .nav {
            width: 100%;
        }
        .nav-left {
            width: 100%;
        }
    }
    
    
    .nav-right .title-list nav a .post-title, .nav-right .title-list #local-search-result a .post-title {
        color: #383636;
    }
    
    
    .nav-right .title-list nav a .post-date, .nav-right .title-list #local-search-result a .post-date {
        color: #5e5e5f;
    }
    
    
    .nav-right nav a.hover, #local-search-result a.hover{
        background-color: #e2e0e0;
    }
    
    

    /*åˆ—è¡¨æ ·å¼*/
    

    /* èƒŒæ™¯å›¾æ ·å¼ */
    
    


    /*å¼•ç”¨å—æ ·å¼*/
    

    /*æ–‡ç« åˆ—è¡¨èƒŒæ™¯å›¾*/
    

    
</style>







</html>
