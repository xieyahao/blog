<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>blockçš„ç†è§£/blockçš„ç†è§£ | yahaoâ€˜s note</title>
  <meta name="keywords" content="">
  <meta name="description" content="blockçš„ç†è§£/blockçš„ç†è§£ | yahaoâ€˜s note">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="iOSä¸­çš„å†…å­˜ç®¡ç†object-C ä¸­é‡‡å–ARCï¼ˆAutomatic Reference Countingï¼‰æœºåˆ¶ï¼Œè®©ç¼–è¯‘å™¨æ¥è¿›è¡Œå†…å­˜ç®¡ç†ã€‚ 1ã€æ‰‹åŠ¨ç®¡ç†å†…å­˜æ—¶ï¼Œå¼•ç”¨è®¡æ•°å¼å†…å­˜ç®¡ç†çš„æ€è€ƒæ–¹å¼æ˜¯æ€æ ·çš„ï¼Ÿ è‡ªå·±ç”Ÿæˆçš„å¯¹è±¡è‡ªå·±æŒæœ‰ï¼› éè‡ªå·±ç”Ÿæˆçš„å¯¹è±¡ï¼Œè‡ªå·±ä¹Ÿèƒ½æŒæœ‰ï¼› ä¸å†éœ€è¦è‡ªå·±æŒæœ‰çš„å¯¹è±¡æ—¶é‡Šæ”¾ï¼› éè‡ªå·±æŒæœ‰çš„å¯¹è±¡æ— æ³•é‡Šæ”¾ï¼›  å¯¹åº”äºOCé‡Œï¼Œalloc&#x2F;new&#x2F;copy&#x2F;mutableCopyç­‰æ–¹æ³•">
<meta property="og:type" content="article">
<meta property="og:title" content="iOSå†…å­˜ç®¡ç†çš„ç†è§£&#x2F;iOSå†…å­˜ç®¡ç†">
<meta property="og:url" content="https://xieyahao.github.io/blog/iOS%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E7%9A%84%E7%90%86%E8%A7%A3/iOS%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/index.html">
<meta property="og:site_name" content="yahaoâ€˜s note">
<meta property="og:description" content="iOSä¸­çš„å†…å­˜ç®¡ç†object-C ä¸­é‡‡å–ARCï¼ˆAutomatic Reference Countingï¼‰æœºåˆ¶ï¼Œè®©ç¼–è¯‘å™¨æ¥è¿›è¡Œå†…å­˜ç®¡ç†ã€‚ 1ã€æ‰‹åŠ¨ç®¡ç†å†…å­˜æ—¶ï¼Œå¼•ç”¨è®¡æ•°å¼å†…å­˜ç®¡ç†çš„æ€è€ƒæ–¹å¼æ˜¯æ€æ ·çš„ï¼Ÿ è‡ªå·±ç”Ÿæˆçš„å¯¹è±¡è‡ªå·±æŒæœ‰ï¼› éè‡ªå·±ç”Ÿæˆçš„å¯¹è±¡ï¼Œè‡ªå·±ä¹Ÿèƒ½æŒæœ‰ï¼› ä¸å†éœ€è¦è‡ªå·±æŒæœ‰çš„å¯¹è±¡æ—¶é‡Šæ”¾ï¼› éè‡ªå·±æŒæœ‰çš„å¯¹è±¡æ— æ³•é‡Šæ”¾ï¼›  å¯¹åº”äºOCé‡Œï¼Œalloc&#x2F;new&#x2F;copy&#x2F;mutableCopyç­‰æ–¹æ³•">
<meta property="og:locale" content="zh">
<meta property="article:published_time" content="2021-03-29T04:07:53.143Z">
<meta property="article:modified_time" content="2021-03-30T03:06:27.256Z">
<meta name="twitter:card" content="summary">


<link rel="icon" href="/img/avatar.jpg">

<link href="/blog/css/style.css?v=1.1.0" rel="stylesheet">

<link href="/blog/css/hl_theme/atom-light.css?v=1.1.0" rel="stylesheet">

<link href="//cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css" rel="stylesheet">

<script src="//cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<script src="/blog/js/titleTip.js?v=1.1.0" ></script>

<script src="//cdn.jsdelivr.net/npm/highlightjs@9.16.2/highlight.pack.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>

<script src="//cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script>



<script src="//cdn.jsdelivr.net/npm/jquery.cookie@1.4.1/jquery.cookie.min.js" ></script>

<script src="/blog/js/iconfont.js?v=1.1.0" ></script>

<meta name="generator" content="Hexo 4.2.1"></head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_preload_comment" value="">
  <input class="theme_blog_path" value="/blog">
  <input id="theme_shortcut" value="true" />
</div>


<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/blog/" class="avatar_target">
    <img class="avatar" src="/blog/img/avatar.jpg" />
</a>
<div class="author">
    <span></span>
</div>

<div class="icon">
    
</div>



<a class="more-menus">æ›´å¤šèœå•</a>


<ul>
    <li><div class="all active" data-rel="All">All<small>(10)</small></div></li>
    
</ul>
<div class="left-bottom">
    <div class="menus">
    
    
    
    
    <a class="dynamic-menu " target="_blank"  href="https://github.com/xieyahao">github</a>
    
    </div>
    <div></div>
</div>
<input type="hidden" id="yelog_site_posts_number" value="10">

<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>

    </div>
    <div class="nav-right">
        <div class="friends-area">
    <div class="friends-title">
        Links
        <i class="iconfont icon-left"></i>
    </div>
    <div class="friends-content">
        <ul>
            
        </ul>
    </div>
</div>
        <div class="title-list">
    <div class="right-top">
        <div id="default-panel">
            <i class="iconfont icon-search" data-title="æœç´¢ å¿«æ·é”® i"></i>
            <div class="right-title">All</div>
            <i class="iconfont icon-file-tree" data-title="åˆ‡æ¢åˆ°å¤§çº²è§†å›¾ å¿«æ·é”® w"></i>
        </div>
        <div id="search-panel">
            <i class="iconfont icon-left" data-title="è¿”å›"></i>
            <input id="local-search-input" />
            <label class="border-line" for="input"></label>
            <i class="iconfont icon-case-sensitive" data-title="å¤§å°å†™æ•æ„Ÿ"></i>
            <i class="iconfont icon-tag" data-title="æ ‡ç­¾"></i>
        </div>
        <div id="outline-panel" style="display: none">
            <div class="right-title">å¤§çº²</div>
            <i class="iconfont icon-list" data-title="åˆ‡æ¢åˆ°æ–‡ç« åˆ—è¡¨"></i>
        </div>
    </div>

    <div class="tags-list">
    <input id="tag-search" />
    <div class="tag-wrapper">
        
    </div>

</div>

    
    <nav id="title-list-nav">
        
        <a  class="All "
           href="/blog/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="å­¦ä¹ ç¬”è®°">å­¦ä¹ ç¬”è®°</span>
            <span class="post-date" title="2021-04-26 10:21:38">2021/04/26</span>
        </a>
        
        <a  class="All "
           href="/blog/iOS%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E7%9A%84%E7%90%86%E8%A7%A3/iOS%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="iOSå†…å­˜ç®¡ç†çš„ç†è§£/iOSå†…å­˜ç®¡ç†">iOSå†…å­˜ç®¡ç†çš„ç†è§£/iOSå†…å­˜ç®¡ç†</span>
            <span class="post-date" title="2021-03-29 12:07:53">2021/03/29</span>
        </a>
        
        <a  class="All "
           href="/blog/viewController_life_time/ios_life_time%20/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="viewController_life_time/ios_life_time ">viewController_life_time/ios_life_time </span>
            <span class="post-date" title="2021-03-25 15:32:23">2021/03/25</span>
        </a>
        
        <a  class="All "
           href="/blog/block%E7%9A%84%E7%90%86%E8%A7%A3/block%E7%9A%84%E7%90%86%E8%A7%A3/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="blockçš„ç†è§£/blockçš„ç†è§£">blockçš„ç†è§£/blockçš„ç†è§£</span>
            <span class="post-date" title="2021-03-23 14:48:32">2021/03/23</span>
        </a>
        
        <a  class="All "
           href="/blog/iOS%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="iOSå†…å­˜æ³„æ¼">iOSå†…å­˜æ³„æ¼</span>
            <span class="post-date" title="2021-03-19 13:54:34">2021/03/19</span>
        </a>
        
        <a  class="All "
           href="/blog/%E6%B7%B1%E6%8B%B7%E8%B4%9D%E4%B8%8E%E6%B5%85%E6%8B%B7%E8%B4%9D/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="æ·±æ‹·è´ä¸æµ…æ‹·è´">æ·±æ‹·è´ä¸æµ…æ‹·è´</span>
            <span class="post-date" title="2021-03-19 10:28:36">2021/03/19</span>
        </a>
        
        <a  class="All "
           href="/blog/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0-core%20animation/coreAnimationAdvancedTechniques/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="è¯»ä¹¦ç¬”è®°-core animation/coreAnimationAdvancedTechniques">è¯»ä¹¦ç¬”è®°-core animation/coreAnimationAdvancedTechniques</span>
            <span class="post-date" title="2020-06-16 14:59:51">2020/06/16</span>
        </a>
        
        <a  class="All "
           href="/blog/hello-world/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Hello World">Hello World</span>
            <span class="post-date" title="2020-05-29 18:29:00">2020/05/29</span>
        </a>
        
        <a  class="All "
           href="/blog/block%E7%9A%84%E6%9C%AC%E8%B4%A8/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="blockçš„æœ¬è´¨">blockçš„æœ¬è´¨</span>
            <span class="post-date" title="2020-05-29 18:29:00">2020/05/29</span>
        </a>
        
        <a  class="All "
           href="/blog/runtime%E5%AD%A6%E4%B9%A0%E4%B8%80/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="runtimeå­¦ä¹ ä¸€">runtimeå­¦ä¹ ä¸€</span>
            <span class="post-date" title="2020-05-28 15:43:26">2020/05/28</span>
        </a>
        
        <div id="no-item-tips">

        </div>
    </nav>
    <div id="outline-list">
    </div>
</div>
    </div>
    <div class="hide-list">
        <div class="semicircle" data-title="åˆ‡æ¢å…¨å± å¿«æ·é”® s">
            <div class="brackets first"><</div>
            <div class="brackets">&gt;</div>
        </div>
    </div>
</aside>
<div id="post">
    <div class="pjax">
        <article id="post-blockçš„ç†è§£/blockçš„ç†è§£" class="article article-type-post" itemscope itemprop="blogPost">
    
        <h1 class="article-title">blockçš„ç†è§£/blockçš„ç†è§£</h1>
    
    <div class="article-meta">
        
        
        
        
    </div>
    <div class="article-meta">
        
            Created At : <time class="date" title='Updated At: 2021-03-25 15:29:54'>2021-03-23 14:48</time>
        
    </div>
    <div class="article-meta">
        
        
        <span id="busuanzi_container_page_pv">
            Views ğŸ‘€ :<span id="busuanzi_value_page_pv">
                <span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </span>
        </span>
        
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#block-çš„ç†è§£"><span class="toc-text">block çš„ç†è§£</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1ã€blockçš„è¯­æ³•å½¢å¼"><span class="toc-text">1ã€blockçš„è¯­æ³•å½¢å¼</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ï¼ˆ1ï¼‰-è¿”å›ç±»å‹-å‚æ•°ç±»å‹-å‚æ•°-å®ç°è¯­å¥"><span class="toc-text">ï¼ˆ1ï¼‰^ è¿”å›ç±»å‹(å‚æ•°ç±»å‹ å‚æ•°){&#x2F;&#x2F;å®ç°è¯­å¥}</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ï¼ˆ2ï¼‰blockçš„æ‰§è¡Œ"><span class="toc-text">ï¼ˆ2ï¼‰blockçš„æ‰§è¡Œ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ï¼ˆ3ï¼‰blockç±»å‹å˜é‡ä¸å…¶ä»–ç±»å‹å˜é‡ä¸€æ ·å—ï¼Ÿ"><span class="toc-text">ï¼ˆ3ï¼‰blockç±»å‹å˜é‡ä¸å…¶ä»–ç±»å‹å˜é‡ä¸€æ ·å—ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2ã€blockè¯­æ³•çš„ç‰¹æ€§ï¼Ÿ"><span class="toc-text">2ã€blockè¯­æ³•çš„ç‰¹æ€§ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ï¼ˆ1ï¼‰æˆªè·è‡ªåŠ¨å˜é‡å€¼æœ‰ä»€ä¹ˆè¡¨ç°ï¼Ÿ"><span class="toc-text">ï¼ˆ1ï¼‰æˆªè·è‡ªåŠ¨å˜é‡å€¼æœ‰ä»€ä¹ˆè¡¨ç°ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ï¼ˆ2ï¼‰èƒ½ä¿®æ”¹è¢«æˆªè·çš„è‡ªåŠ¨å˜é‡å€¼å—ï¼Œå…¶ä»–ç±»å‹å˜é‡å¯ä»¥è¢«ä¿®æ”¹å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿè¯¥æ€ä¹ˆè§£å†³ï¼Ÿ"><span class="toc-text">ï¼ˆ2ï¼‰èƒ½ä¿®æ”¹è¢«æˆªè·çš„è‡ªåŠ¨å˜é‡å€¼å—ï¼Œå…¶ä»–ç±»å‹å˜é‡å¯ä»¥è¢«ä¿®æ”¹å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿè¯¥æ€ä¹ˆè§£å†³ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ï¼ˆ3ï¼‰-block-ä¸ºä»€ä¹ˆå¯ä»¥ä¿®æ”¹è‡ªåŠ¨å˜é‡å€¼å‘¢ï¼Ÿ"><span class="toc-text">ï¼ˆ3ï¼‰__block ä¸ºä»€ä¹ˆå¯ä»¥ä¿®æ”¹è‡ªåŠ¨å˜é‡å€¼å‘¢ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#blockçš„å­˜å‚¨åŸŸ"><span class="toc-text">- blockçš„å­˜å‚¨åŸŸ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#NSConcreteStackBlockå¯¹è±¡ä¸blockå¯¹è±¡-blockå˜é‡ä¹Ÿéƒ½æ˜¯å­˜å‚¨åœ¨æ ˆä¸Šï¼Œé‚£ä¹ˆè¶…å‡ºä½œç”¨åŸŸä¸ä¼šè¢«é”€æ¯çš„åŸå› æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ"><span class="toc-text">_NSConcreteStackBlockå¯¹è±¡ä¸blockå¯¹è±¡&#x2F;blockå˜é‡ä¹Ÿéƒ½æ˜¯å­˜å‚¨åœ¨æ ˆä¸Šï¼Œé‚£ä¹ˆè¶…å‡ºä½œç”¨åŸŸä¸ä¼šè¢«é”€æ¯çš„åŸå› æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#forwardingçš„ä½œç”¨æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ"><span class="toc-text">__forwardingçš„ä½œç”¨æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ï¼ˆ4ï¼‰blockä¸­æˆªè·çš„å¯¹è±¡ï¼Œåœ¨è¶…å‡ºä½œç”¨åŸŸä»å¯ä½¿ç”¨æ˜¯ä»€ä¹ˆåŸå› ï¼Ÿ"><span class="toc-text">ï¼ˆ4ï¼‰blockä¸­æˆªè·çš„å¯¹è±¡ï¼Œåœ¨è¶…å‡ºä½œç”¨åŸŸä»å¯ä½¿ç”¨æ˜¯ä»€ä¹ˆåŸå› ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ï¼ˆ5ï¼‰blockæ˜¯å¦‚ä½•å¼•å‘çš„å¾ªç¯å¼•ç”¨çš„ï¼Ÿ"><span class="toc-text">ï¼ˆ5ï¼‰blockæ˜¯å¦‚ä½•å¼•å‘çš„å¾ªç¯å¼•ç”¨çš„ï¼Ÿ</span></a></li></ol></li></ol></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-3 i,
    .toc-level-3 ol {
        display: none !important;
    }
</style>
</div>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="block-çš„ç†è§£"><a href="#block-çš„ç†è§£" class="headerlink" title="block çš„ç†è§£"></a>block çš„ç†è§£</h1><h2 id="1ã€blockçš„è¯­æ³•å½¢å¼"><a href="#1ã€blockçš„è¯­æ³•å½¢å¼" class="headerlink" title="1ã€blockçš„è¯­æ³•å½¢å¼"></a>1ã€blockçš„è¯­æ³•å½¢å¼</h2><h3 id="ï¼ˆ1ï¼‰-è¿”å›ç±»å‹-å‚æ•°ç±»å‹-å‚æ•°-å®ç°è¯­å¥"><a href="#ï¼ˆ1ï¼‰-è¿”å›ç±»å‹-å‚æ•°ç±»å‹-å‚æ•°-å®ç°è¯­å¥" class="headerlink" title="ï¼ˆ1ï¼‰^ è¿”å›ç±»å‹(å‚æ•°ç±»å‹ å‚æ•°){//å®ç°è¯­å¥}"></a>ï¼ˆ1ï¼‰^ è¿”å›ç±»å‹(å‚æ•°ç±»å‹ å‚æ•°){//å®ç°è¯­å¥}</h3><p>å¯¹æ¯”äºä¸€èˆ¬å‡½æ•°ï¼Œå¤šäº†ä¸€ä¸ª^ï¼Œå´æ²¡æœ‰åç§°ï¼Œblock ä¹Ÿè¢«ç§°ä¸ºï¼ˆå¸¦æœ‰è‡ªåŠ¨å˜é‡çš„ï¼‰åŒ¿åå‡½æ•°ï¼›</p>
<h3 id="ï¼ˆ2ï¼‰blockçš„æ‰§è¡Œ"><a href="#ï¼ˆ2ï¼‰blockçš„æ‰§è¡Œ" class="headerlink" title="ï¼ˆ2ï¼‰blockçš„æ‰§è¡Œ"></a>ï¼ˆ2ï¼‰blockçš„æ‰§è¡Œ</h3><p>ä¸Cè¯­è¨€å‡½æ•°èƒ½å¤Ÿï¼ŒæŠŠæ‰€å®šä¹‰å‡½æ•°çš„åœ°å€èµ‹å€¼ç»™å‡½æ•°æŒ‡é’ˆç±»æ¯”ï¼Œå¯å¾—ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span>(^block1)(<span class="keyword">int</span>)  = ^(<span class="keyword">int</span> count)&#123;</span><br><span class="line">    printf(<span class="string">"block1==%d"</span>, count);</span><br><span class="line"> &#125;;</span><br><span class="line"> block1(<span class="number">2</span>);</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥ç†è§£ä¸ºï¼ŒæŠŠé€šè¿‡blockè¯­æ³•ç”Ÿæˆçš„blockå€¼ï¼Œèµ‹å€¼ç»™blockç±»å‹å˜é‡ï¼›<br>ä¸ºäº†æ–¹ä¾¿ï¼Œå¯ç”¨typedefå£°æ˜blockTypeç±»å‹ï¼›</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span>  <span class="keyword">void</span>(^blockType)(<span class="keyword">int</span>);</span><br><span class="line"></span><br><span class="line">blockType block2 = ^(<span class="keyword">int</span> count)&#123;</span><br><span class="line">  printf(<span class="string">"block2==%d"</span>, count);</span><br><span class="line"> &#125;;</span><br><span class="line">block2(<span class="number">2</span>);</span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ3ï¼‰blockç±»å‹å˜é‡ä¸å…¶ä»–ç±»å‹å˜é‡ä¸€æ ·å—ï¼Ÿ"><a href="#ï¼ˆ3ï¼‰blockç±»å‹å˜é‡ä¸å…¶ä»–ç±»å‹å˜é‡ä¸€æ ·å—ï¼Ÿ" class="headerlink" title="ï¼ˆ3ï¼‰blockç±»å‹å˜é‡ä¸å…¶ä»–ç±»å‹å˜é‡ä¸€æ ·å—ï¼Ÿ"></a>ï¼ˆ3ï¼‰blockç±»å‹å˜é‡ä¸å…¶ä»–ç±»å‹å˜é‡ä¸€æ ·å—ï¼Ÿ</h3><p>ä¸€æ ·ï¼Œéƒ½å¯åšä¸ºï¼š</p>
<ul>
<li>è‡ªåŠ¨å˜é‡ï¼ˆä¸´æ—¶å˜é‡ï¼‰</li>
<li>å‡½æ•°å‚æ•°</li>
<li>é™æ€å˜é‡</li>
<li>é™æ€å…¨å±€å˜é‡</li>
<li>å…¨å±€å˜é‡<h2 id="2ã€blockè¯­æ³•çš„ç‰¹æ€§ï¼Ÿ"><a href="#2ã€blockè¯­æ³•çš„ç‰¹æ€§ï¼Ÿ" class="headerlink" title="2ã€blockè¯­æ³•çš„ç‰¹æ€§ï¼Ÿ"></a>2ã€blockè¯­æ³•çš„ç‰¹æ€§ï¼Ÿ</h2><h3 id="ï¼ˆ1ï¼‰æˆªè·è‡ªåŠ¨å˜é‡å€¼æœ‰ä»€ä¹ˆè¡¨ç°ï¼Ÿ"><a href="#ï¼ˆ1ï¼‰æˆªè·è‡ªåŠ¨å˜é‡å€¼æœ‰ä»€ä¹ˆè¡¨ç°ï¼Ÿ" class="headerlink" title="ï¼ˆ1ï¼‰æˆªè·è‡ªåŠ¨å˜é‡å€¼æœ‰ä»€ä¹ˆè¡¨ç°ï¼Ÿ"></a>ï¼ˆ1ï¼‰æˆªè·è‡ªåŠ¨å˜é‡å€¼æœ‰ä»€ä¹ˆè¡¨ç°ï¼Ÿ</h3>åœ¨blockè¯­æ³•é‡Œä½¿ç”¨è‡ªåŠ¨å˜é‡æ—¶ï¼Œè¾“å‡ºå‘ç°æ˜¯ä¿®æ”¹å‰çš„å€¼ï¼ˆå¦‚ä¸‹æ‰€ç¤ºï¼šï¼‰ã€‚åœ¨blockè¯­æ³•é‡Œä¿®æ”¹è‡ªåŠ¨å˜é‡çš„å€¼ï¼Œå°†å¼•å‘ç¼–è¯‘é”™è¯¯ï¼Œæç¤ºä½¿ç”¨__blockä¿®é¥°ï¼›<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> num = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">void</span>(^block1)(<span class="keyword">void</span>)  = ^&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"block1 = %d"</span>,num);</span><br><span class="line">&#125;;</span><br><span class="line">num = <span class="number">2</span>;</span><br><span class="line">block1(); <span class="comment">// block1 = 1</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ2ï¼‰èƒ½ä¿®æ”¹è¢«æˆªè·çš„è‡ªåŠ¨å˜é‡å€¼å—ï¼Œå…¶ä»–ç±»å‹å˜é‡å¯ä»¥è¢«ä¿®æ”¹å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿè¯¥æ€ä¹ˆè§£å†³ï¼Ÿ"><a href="#ï¼ˆ2ï¼‰èƒ½ä¿®æ”¹è¢«æˆªè·çš„è‡ªåŠ¨å˜é‡å€¼å—ï¼Œå…¶ä»–ç±»å‹å˜é‡å¯ä»¥è¢«ä¿®æ”¹å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿè¯¥æ€ä¹ˆè§£å†³ï¼Ÿ" class="headerlink" title="ï¼ˆ2ï¼‰èƒ½ä¿®æ”¹è¢«æˆªè·çš„è‡ªåŠ¨å˜é‡å€¼å—ï¼Œå…¶ä»–ç±»å‹å˜é‡å¯ä»¥è¢«ä¿®æ”¹å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿè¯¥æ€ä¹ˆè§£å†³ï¼Ÿ"></a>ï¼ˆ2ï¼‰èƒ½ä¿®æ”¹è¢«æˆªè·çš„è‡ªåŠ¨å˜é‡å€¼å—ï¼Œå…¶ä»–ç±»å‹å˜é‡å¯ä»¥è¢«ä¿®æ”¹å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿè¯¥æ€ä¹ˆè§£å†³ï¼Ÿ</h3>ä¸èƒ½è¢«ä¿®æ”¹ï¼Œå¯¹äºå…¨å±€å˜é‡ã€é™æ€å˜é‡ã€é™æ€å…¨å±€å˜é‡å¯ä»¥ä¿®æ”¹ã€‚å‡†ç¡®åœ°è¯´ï¼Œæˆªè·çš„è‡ªåŠ¨å˜é‡æ˜¯ä¸èƒ½è¢«é‡æ–°èµ‹å€¼çš„ï¼Œå¯¹äºå¯å˜çš„å˜é‡ï¼Œå¦‚NSMutableStringã€NSMutableArrayã€æ˜¯å¯ä»¥ä¿®æ”¹å€¼çš„ï¼Œä½†ä¸èƒ½è¢«é‡æ–°èµ‹å€¼ï¼›</li>
</ul>
<p>ä¸ºä»€ä¹ˆä¸èƒ½ä¿®æ”¹ï¼Ÿ<br>é€šè¿‡clang(LLVMç¼–è¯‘å™¨)æŠŠblockè½¬æ¢ä¸ºæˆ‘ä»¬å¯è¯»æºä»£ç ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">clang -rewrite-objc æºä»£ç æ–‡ä»¶åç§°</span><br></pre></td></tr></table></figure>
<p>è½¬æ¢åï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> __<span class="title">main_block_impl_0</span> &#123;</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> __<span class="title">block_impl</span> <span class="title">impl</span>;</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> __<span class="title">main_block_desc_0</span>* <span class="title">Desc</span>;</span></span><br><span class="line">  <span class="keyword">int</span> num;</span><br><span class="line">  __main_block_impl_0(<span class="keyword">void</span> *fp, struct __main_block_desc_0 *desc, <span class="keyword">int</span> _num, <span class="keyword">int</span> flags=<span class="number">0</span>) : num(_num) &#123;</span><br><span class="line">    impl.isa = &amp;_NSConcreteStackBlock;</span><br><span class="line">    impl.Flags = flags;</span><br><span class="line">    impl.FuncPtr = fp;</span><br><span class="line">    Desc = desc;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> __main_block_func_0(struct __main_block_impl_0 *__cself) &#123;</span><br><span class="line">  <span class="keyword">int</span> num = __cself-&gt;num; <span class="comment">// bound by copy</span></span><br><span class="line"></span><br><span class="line">      NSLog((NSString *)&amp;__NSConstantStringImpl__var_folders_tl_9wc89m9x72x0tlbwylxrqk140000gn_T_main_dc6460_mi_0,num);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">struct</span> __<span class="title">main_block_desc_0</span> &#123;</span></span><br><span class="line">  <span class="keyword">size_t</span> reserved;</span><br><span class="line">  <span class="keyword">size_t</span> Block_size;</span><br><span class="line">&#125; __main_block_desc_0_DATA = &#123; <span class="number">0</span>, <span class="keyword">sizeof</span>(struct __main_block_impl_0)&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> * argv[])</span> </span>&#123;</span><br><span class="line">    NSString * appDelegateClassName;</span><br><span class="line">    <span class="comment">/* @autoreleasepool */</span> &#123; __AtAutoreleasePool __autoreleasepool; </span><br><span class="line"></span><br><span class="line">        appDelegateClassName = NSStringFromClass(((Class (*)(id, SEL))(<span class="keyword">void</span> *)objc_msgSend)((id)objc_getClass(<span class="string">"AppDelegate"</span>), sel_registerName(<span class="string">"class"</span>)));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">int</span> num = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">void</span>(*block1)(<span class="keyword">void</span>) = ((<span class="keyword">void</span> (*)())&amp;__main_block_impl_0((<span class="keyword">void</span> *)__main_block_func_0, &amp;__main_block_desc_0_DATA, num));</span><br><span class="line"></span><br><span class="line">   num = <span class="number">2</span>;</span><br><span class="line">      </span><br><span class="line">   ((<span class="keyword">void</span> (*)(__block_impl *))((__block_impl *)block1)-&gt;FuncPtr)((__block_impl *)block1);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> UIApplicationMain(argc, argv, __null, appDelegateClassName);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç”±</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">impl.isa = &amp;_NSConcreteStackBlock;</span><br></pre></td></tr></table></figure>
<ul>
<li>åœ¨Object-Cä¸­ç”Ÿæˆç±»çš„å¯¹è±¡ï¼Œç›¸å½“äºç”Ÿæˆè¯¥ç±»çš„å¯¹è±¡çš„ç»“æ„ä½“å®ä¾‹ï¼›æŸ¥çœ‹æºç æˆ‘ä»¬å¯çŸ¥blockæ˜¯OCå¯¹è±¡ï¼›</li>
<li>ä¸”block è¯­æ³•è¡¨è¾¾å¼ä¸­ï¼Œä½¿ç”¨çš„è‡ªåŠ¨å˜é‡è¢«ä½œä¸ºæˆå‘˜å˜é‡è¿½åŠ åˆ°äº† __main_block_impl_0ç»“æ„ä½“ä¸­ï¼Œè‡ªåŠ¨å˜é‡å€¼è¢«æˆªè·ï¼›<br>æ•è·åçš„ä¿®æ”¹ï¼Œå’Œå·²æ•è·å˜é‡ä¸æ˜¯åŒä¸€ä¸ªå˜é‡ï¼Œå› æ­¤æ— æ³•ä¿®æ”¹ï¼›</li>
<li>å¯¹äº å…¨å±€é™æ€å˜é‡ã€å…¨å±€å˜é‡çš„ä¿®æ”¹é€šè¿‡æºç å’Œå®è·µå¯çŸ¥ï¼Œæ²¡æœ‰è¿›è¡Œæ•è·ï¼Œå¯ä¿®æ”¹ï¼›</li>
<li>å¯¹äºé™æ€è‡ªåŠ¨å˜é‡ï¼Œè¿›è¡Œäº†æ•è·ï¼ŒæŠŠé™æ€è‡ªåŠ¨å˜é‡çš„æŒ‡é’ˆä¼ é€’ç»™_main_block_impl_0ç»“æ„ä½“çš„æ„é€ å‡½æ•°å¹¶ä¿å­˜ã€‚é€šè¿‡æŒ‡é’ˆè¿›è¡Œèµ‹å€¼ï¼Œå¯ä»¥ç›´æ¥ä¿®æ”¹å€¼ï¼›</li>
</ul>
<h3 id="ï¼ˆ3ï¼‰-block-ä¸ºä»€ä¹ˆå¯ä»¥ä¿®æ”¹è‡ªåŠ¨å˜é‡å€¼å‘¢ï¼Ÿ"><a href="#ï¼ˆ3ï¼‰-block-ä¸ºä»€ä¹ˆå¯ä»¥ä¿®æ”¹è‡ªåŠ¨å˜é‡å€¼å‘¢ï¼Ÿ" class="headerlink" title="ï¼ˆ3ï¼‰__block ä¸ºä»€ä¹ˆå¯ä»¥ä¿®æ”¹è‡ªåŠ¨å˜é‡å€¼å‘¢ï¼Ÿ"></a>ï¼ˆ3ï¼‰__block ä¸ºä»€ä¹ˆå¯ä»¥ä¿®æ”¹è‡ªåŠ¨å˜é‡å€¼å‘¢ï¼Ÿ</h3><ul>
<li><strong>blockè¯´æ˜ç¬¦ï¼Œæ˜¯ä»€ä¹ˆï¼Ÿ<br>__block å­˜å‚¨åŸŸç±»è¯´æ˜ç¬¦ï¼ŒCè¯­è¨€ä¸­æœ‰ä»¥ä¸‹å­˜å‚¨åŸŸç±»è¯´æ˜ç¬¦ï¼Œtypedefã€externã€staticã€autoã€registerã€‚</strong>block ç±»ä¼¼äºstaticã€autoã€registerè¯´æ˜ç¬¦ï¼Œç”¨äºæŒ‡å®šå°†å˜é‡å€¼è®¾ç½®åˆ°å“ªä¸ªå­˜å‚¨åŸŸã€‚</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">__block <span class="keyword">int</span> num = <span class="number">1</span>;</span><br><span class="line"> </span><br><span class="line"> <span class="keyword">void</span>(^block1)(<span class="keyword">void</span>)  = ^&#123;</span><br><span class="line">   num = <span class="number">2</span>;</span><br><span class="line"> &#125;;</span><br><span class="line"> </span><br><span class="line"> block1();</span><br></pre></td></tr></table></figure>
<p>æºç è½¬æ¢å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> __<span class="title">Block_byref_num_0</span> &#123;</span></span><br><span class="line">  <span class="keyword">void</span> *__isa;</span><br><span class="line">__Block_byref_num_0 *__forwarding;</span><br><span class="line"> <span class="keyword">int</span> __flags;</span><br><span class="line"> <span class="keyword">int</span> __size;</span><br><span class="line"> <span class="keyword">int</span> num;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> __<span class="title">main_block_impl_0</span> &#123;</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> __<span class="title">block_impl</span> <span class="title">impl</span>;</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> __<span class="title">main_block_desc_0</span>* <span class="title">Desc</span>;</span></span><br><span class="line">  __Block_byref_num_0 *num; <span class="comment">// by ref</span></span><br><span class="line">  __main_block_impl_0(<span class="keyword">void</span> *fp, struct __main_block_desc_0 *desc, __Block_byref_num_0 *_num, <span class="keyword">int</span> flags=<span class="number">0</span>) : num(_num-&gt;__forwarding) &#123;</span><br><span class="line">    impl.isa = &amp;_NSConcreteStackBlock;</span><br><span class="line">    impl.Flags = flags;</span><br><span class="line">    impl.FuncPtr = fp;</span><br><span class="line">    Desc = desc;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> __main_block_func_0(struct __main_block_impl_0 *__cself) &#123;</span><br><span class="line">  __Block_byref_num_0 *num = __cself-&gt;num; <span class="comment">// bound by ref</span></span><br><span class="line"></span><br><span class="line">      (num-&gt;__forwarding-&gt;num) = <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> __main_block_copy_0(struct __main_block_impl_0*dst, struct __main_block_impl_0*src) &#123;_Block_object_assign((<span class="keyword">void</span>*)&amp;dst-&gt;num, (<span class="keyword">void</span>*)src-&gt;num, <span class="number">8</span><span class="comment">/*BLOCK_FIELD_IS_BYREF*/</span>);&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> __main_block_dispose_0(struct __main_block_impl_0*src) &#123;_Block_object_dispose((<span class="keyword">void</span>*)src-&gt;num, <span class="number">8</span><span class="comment">/*BLOCK_FIELD_IS_BYREF*/</span>);&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">struct</span> __<span class="title">main_block_desc_0</span> &#123;</span></span><br><span class="line">  <span class="keyword">size_t</span> reserved;</span><br><span class="line">  <span class="keyword">size_t</span> Block_size;</span><br><span class="line">  <span class="keyword">void</span> (*copy)(struct __main_block_impl_0*, struct __main_block_impl_0*);</span><br><span class="line">  <span class="keyword">void</span> (*dispose)(struct __main_block_impl_0*);</span><br><span class="line">&#125; __main_block_desc_0_DATA = &#123; <span class="number">0</span>, <span class="keyword">sizeof</span>(struct __main_block_impl_0), __main_block_copy_0, __main_block_dispose_0&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> * argv[])</span> </span>&#123;</span><br><span class="line">    NSString * appDelegateClassName;</span><br><span class="line">    <span class="comment">/* @autoreleasepool */</span> &#123; __AtAutoreleasePool __autoreleasepool; </span><br><span class="line"></span><br><span class="line">        appDelegateClassName = NSStringFromClass(((Class (*)(id, SEL))(<span class="keyword">void</span> *)objc_msgSend)((id)objc_getClass(<span class="string">"AppDelegate"</span>), sel_registerName(<span class="string">"class"</span>)));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   __attribute__((__blocks__(byref))) __Block_byref_num_0 num = &#123;(<span class="keyword">void</span>*)<span class="number">0</span>,(__Block_byref_num_0 *)&amp;num, <span class="number">0</span>, <span class="keyword">sizeof</span>(__Block_byref_num_0), <span class="number">1</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span>(*block1)(<span class="keyword">void</span>) = ((<span class="keyword">void</span> (*)())&amp;__main_block_impl_0((<span class="keyword">void</span> *)__main_block_func_0, &amp;__main_block_desc_0_DATA, (__Block_byref_num_0 *)&amp;num, <span class="number">570425344</span>));</span><br><span class="line"></span><br><span class="line">    ((<span class="keyword">void</span> (*)(__block_impl *))((__block_impl *)block1)-&gt;FuncPtr)((__block_impl *)block1);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> UIApplicationMain(argc, argv, __null, appDelegateClassName);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»æºç ä¸­å¯çœ‹åˆ°æ·»åŠ äº†<strong>block è¯´æ˜ç¬¦çš„è‡ªåŠ¨å˜é‡ï¼Œè¢«åŒ…è£…æˆäº†ä¸€ä¸ªç»“æ„ä½“</strong>Block_byref_å˜é‡å_0ï¼Œè‡ªåŠ¨å˜é‡ä½œä¸ºä¸€ä¸ªæˆå‘˜å˜é‡ int numã€‚ ç»™__blockèµ‹å€¼æºç æ˜¯</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> __main_block_func_0(struct __main_block_impl_0 *__cself) &#123;</span><br><span class="line"> </span><br><span class="line">  __Block_byref_num_0 *num = __cself-&gt;num; <span class="comment">// bound by ref</span></span><br><span class="line"></span><br><span class="line">  (num-&gt;__forwarding-&gt;num) = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç»™<strong>blockå˜é‡èµ‹å€¼æ—¶ï¼Œblockçš„</strong>main_block_impl_0 ï¼Œé€šè¿‡__forwaringè®¿é—®æˆå‘˜å˜é‡num.</p>
<ul>
<li>ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšå‘¢ï¼Ÿ</li>
</ul>
<h5 id="blockçš„å­˜å‚¨åŸŸ"><a href="#blockçš„å­˜å‚¨åŸŸ" class="headerlink" title="- blockçš„å­˜å‚¨åŸŸ"></a>- blockçš„å­˜å‚¨åŸŸ</h5><p>| blockçš„ç±»               |å¯¹åº”çš„å­˜å‚¨åŸŸ        |å¯¹åº”çš„å®ç°å½¢å¼|</p>
<ul>
<li>_NSConcreteStackBlock   æ ˆ  é™¤_NSConcreteGlobalBlockå¤–blockè¯­æ³•ç”Ÿæˆçš„blockä¸º_NSConcreteStackBlockå¯¹è±¡ï¼Œä¸”è®¾ç½®åœ¨æ ˆä¸Šã€‚</li>
<li>_NSConcreteGlobalBlock  ç¨‹åºçš„æ•°æ®åŒºåŸŸ(.dataåŒº)  ï¼ˆ1ï¼‰è®°è¿°åœ¨å…¨å±€å˜é‡çš„åœ°æ–¹çš„blockï¼›ï¼ˆ2ï¼‰blockè¯­æ³•ä¸­ä¸ä½¿ç”¨è‡ªåŠ¨å˜é‡</li>
<li>_NSConcreteMallocBlock  å †</li>
</ul>
<h5 id="NSConcreteStackBlockå¯¹è±¡ä¸blockå¯¹è±¡-blockå˜é‡ä¹Ÿéƒ½æ˜¯å­˜å‚¨åœ¨æ ˆä¸Šï¼Œé‚£ä¹ˆè¶…å‡ºä½œç”¨åŸŸä¸ä¼šè¢«é”€æ¯çš„åŸå› æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ"><a href="#NSConcreteStackBlockå¯¹è±¡ä¸blockå¯¹è±¡-blockå˜é‡ä¹Ÿéƒ½æ˜¯å­˜å‚¨åœ¨æ ˆä¸Šï¼Œé‚£ä¹ˆè¶…å‡ºä½œç”¨åŸŸä¸ä¼šè¢«é”€æ¯çš„åŸå› æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ" class="headerlink" title="_NSConcreteStackBlockå¯¹è±¡ä¸blockå¯¹è±¡/blockå˜é‡ä¹Ÿéƒ½æ˜¯å­˜å‚¨åœ¨æ ˆä¸Šï¼Œé‚£ä¹ˆè¶…å‡ºä½œç”¨åŸŸä¸ä¼šè¢«é”€æ¯çš„åŸå› æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ"></a>_NSConcreteStackBlockå¯¹è±¡ä¸<strong>blockå¯¹è±¡/</strong>blockå˜é‡ä¹Ÿéƒ½æ˜¯å­˜å‚¨åœ¨æ ˆä¸Šï¼Œé‚£ä¹ˆè¶…å‡ºä½œç”¨åŸŸä¸ä¼šè¢«é”€æ¯çš„åŸå› æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</h5><p>ç­”æ¡ˆå°±æ˜¯block æä¾›äº†å¤åˆ¶åˆ°å †ä¸Šçš„æ–¹æ³•ã€‚</p>
<ul>
<li>å¤åˆ¶åˆ°å †ä¸Šï¼Œç³»ç»Ÿå¯åœ¨ä»¥ä¸‹æƒ…å†µä¸‹è‡ªåŠ¨å®ç°ï¼š<br>ï¼ˆ1ï¼‰blockä½œä¸ºå‡½æ•°è¿”å›å€¼è¿”å›æ—¶ï¼›<br>ï¼ˆ2ï¼‰cocoaæ¡†æ¶çš„æ–¹æ³•ä¸”æ–¹æ³•åä¸­å«æœ‰usingBlockæ—¶ï¼›<br>ï¼ˆ3ï¼‰GCDçš„APIï¼›</li>
<li>éœ€è¦æ‰‹åŠ¨çš„æƒ…å†µï¼Œblockä½œä¸ºæ–¹æ³•æˆ–å‡½æ•°çš„å‚æ•°æ—¶ï¼› </li>
<li>æ ˆä¸Šçš„blockå¤åˆ¶åˆ°å †ä¸Šçš„æ—¶æœºæœ‰å“ªäº›ï¼Ÿ<br>ï¼ˆ1ï¼‰è°ƒç”¨blockçš„copyå®ä¾‹æ–¹æ³•ã€‚<br>ï¼ˆ2ï¼‰å°†blockèµ‹å€¼ç»™æœ‰__strong ä¿®é¥°ç¬¦çš„idï¼ˆå¯¹è±¡ï¼‰ ç±»å‹çš„ç±»æˆ–è€…blockç±»å‹çš„æˆå‘˜å˜é‡ã€‚<br>ï¼ˆ3ï¼‰ä»¥åŠç³»ç»Ÿè‡ªåŠ¨å®ç°çš„ä¸‰ç§æƒ…å†µä¸‹ã€‚</li>
</ul>
<p>blockè¢«å¤åˆ¶åˆ°å †ä¸Šï¼Œ__block å˜é‡ä¹Ÿä¼šè¢«å¤åˆ¶åˆ°å †ä¸Šã€‚<br><img src="img/block copy.jpeg" width=288 height=216 /></p>
<h5 id="forwardingçš„ä½œç”¨æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ"><a href="#forwardingçš„ä½œç”¨æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ" class="headerlink" title="__forwardingçš„ä½œç”¨æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ"></a>__forwardingçš„ä½œç”¨æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</h5><ul>
<li><strong>block å˜é‡ é€šè¿‡ ç»“æ„ä½“æˆå‘˜å˜é‡</strong>forwardingå¯ä»¥å®ç°ï¼Œæ— è®º<strong>blockå˜é‡é…ç½®åœ¨æ ˆä¸Šè¿˜æ˜¯å †ä¸Šï¼Œéƒ½èƒ½æ­£ç¡®åœ°è®¿é—®</strong>block å˜é‡ã€‚å› ä¸ºåœ¨æ ˆä¸Šæ—¶ï¼Œ<strong>forwardingæŒ‡å‘è‡ªå·±æœ¬èº«çš„æŒ‡é’ˆï¼Œå¤åˆ¶åˆ°å †ä¸Šæ—¶ï¼Œæ ˆä¸Šçš„</strong>forwarding æŒ‡å‘å †ä¸Šçš„â€”â€”â€”â€”blockå˜é‡ç»“æ„ä½“çš„æŒ‡é’ˆï¼Œå †ä¸Šçš„æŒ‡å‘è‡ªå·±æœ¬èº«çš„æŒ‡é’ˆã€‚<img src="img/__forwarding.jpeg" width=288 height=216 />




</li>
</ul>
<h3 id="ï¼ˆ4ï¼‰blockä¸­æˆªè·çš„å¯¹è±¡ï¼Œåœ¨è¶…å‡ºä½œç”¨åŸŸä»å¯ä½¿ç”¨æ˜¯ä»€ä¹ˆåŸå› ï¼Ÿ"><a href="#ï¼ˆ4ï¼‰blockä¸­æˆªè·çš„å¯¹è±¡ï¼Œåœ¨è¶…å‡ºä½œç”¨åŸŸä»å¯ä½¿ç”¨æ˜¯ä»€ä¹ˆåŸå› ï¼Ÿ" class="headerlink" title="ï¼ˆ4ï¼‰blockä¸­æˆªè·çš„å¯¹è±¡ï¼Œåœ¨è¶…å‡ºä½œç”¨åŸŸä»å¯ä½¿ç”¨æ˜¯ä»€ä¹ˆåŸå› ï¼Ÿ"></a>ï¼ˆ4ï¼‰blockä¸­æˆªè·çš„å¯¹è±¡ï¼Œåœ¨è¶…å‡ºä½œç”¨åŸŸä»å¯ä½¿ç”¨æ˜¯ä»€ä¹ˆåŸå› ï¼Ÿ</h3><p>åœ¨</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="keyword">id</span> array = [[<span class="built_in">NSMutableArray</span> alloc]init];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é‡Œï¼Œç”Ÿæˆå¹¶æŒæœ‰NSMutableArrayç±»çš„å¯¹è±¡ï¼Œç”±äºé™„æœ‰__strong ä¿®é¥°ç¬¦çš„èµ‹å€¼ç›®æ ‡å˜é‡çš„ä½œç”¨åŸŸç«‹å³ç»“æŸï¼Œå› æ­¤å¯¹è±¡ç«‹å³é‡Šæ”¾å¹¶åºŸå¼ƒã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">blk_t blk;</span><br><span class="line">  </span><br><span class="line">  &#123;</span><br><span class="line">      <span class="keyword">id</span> array = [[<span class="built_in">NSMutableArray</span> alloc]init];</span><br><span class="line">      blk = [^(<span class="keyword">id</span> obj)&#123;</span><br><span class="line">          </span><br><span class="line">          [array addObject:obj];</span><br><span class="line">          </span><br><span class="line">          <span class="built_in">NSLog</span>(<span class="string">@"array count = %lu"</span>,(<span class="keyword">unsigned</span> <span class="keyword">long</span>)[array count]);</span><br><span class="line">          </span><br><span class="line">      &#125; <span class="keyword">copy</span>];</span><br><span class="line">      </span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  blk([[<span class="built_in">NSObject</span> alloc]init]);</span><br><span class="line">  blk([[<span class="built_in">NSObject</span> alloc]init]);</span><br><span class="line">  blk([[<span class="built_in">NSObject</span> alloc]init]);</span><br><span class="line">  <span class="comment">/* è¾“å‡ºï¼šarray count = 1</span></span><br><span class="line"><span class="comment">  array count = 2</span></span><br><span class="line"><span class="comment">  array count = 3</span></span><br><span class="line"><span class="comment">   */</span></span><br></pre></td></tr></table></figure>

<p>ä¸ºä»€ä¹ˆ array æ²¡æœ‰é‡Šæ”¾å‘¢ï¼Ÿ</p>
<ul>
<li><p>ARCæœ‰æ•ˆæ—¶ï¼Œidç±»å‹ä»¥åŠå¯¹è±¡ç±»å‹å˜é‡å¿…å®šé™„åŠ æ‰€æœ‰æƒä¿®é¥°ç¬¦ï¼Œç¼ºçœæ—¶ä¸ºé™„æœ‰__strongä¿®é¥°ç¬¦çš„å˜é‡ã€‚</p>
</li>
<li><p>å› ä¸ºåœ¨blockä¸­ä½¿ç”¨çš„èµ‹å€¼ç»™ é™„æœ‰<strong>strong ä¿®é¥°ç¬¦çš„è‡ªåŠ¨å˜é‡çš„å¯¹è±¡ï¼Œå’Œå¤åˆ¶åˆ°å †ä¸Šçš„</strong>blockå˜é‡ä¸€æ ·ï¼Œç”±äºè¢«å †ä¸Šçš„blockæ‰€æŒæœ‰ï¼Œå› è€Œå¯è¶…å‡ºå…¶å˜é‡ä½œç”¨åŸŸè€Œå­˜åœ¨ã€‚</p>
</li>
</ul>
<p>ä¸Šé¢çš„ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å†ç”¨__block ä¿®é¥°ï¼Œä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚</p>
<h3 id="ï¼ˆ5ï¼‰blockæ˜¯å¦‚ä½•å¼•å‘çš„å¾ªç¯å¼•ç”¨çš„ï¼Ÿ"><a href="#ï¼ˆ5ï¼‰blockæ˜¯å¦‚ä½•å¼•å‘çš„å¾ªç¯å¼•ç”¨çš„ï¼Ÿ" class="headerlink" title="ï¼ˆ5ï¼‰blockæ˜¯å¦‚ä½•å¼•å‘çš„å¾ªç¯å¼•ç”¨çš„ï¼Ÿ"></a>ï¼ˆ5ï¼‰blockæ˜¯å¦‚ä½•å¼•å‘çš„å¾ªç¯å¼•ç”¨çš„ï¼Ÿ</h3><p>1ã€å½“å¯¹è±¡æŒæœ‰blockï¼ŒblockåˆæŒæœ‰selfæ—¶ã€‚<br> æ‰“ç ´å¾ªç¯å¼•ç”¨æ–¹å¼ï¼š å£°æ˜__weakä¿®é¥°çš„å˜é‡ï¼Œå¹¶å°†selfèµ‹å€¼ä½¿ç”¨ã€‚</p>
<p>2ã€myObjectç±»å¯¹è±¡æŒæœ‰blockï¼Œ<br>blockæŒæœ‰__blockå˜é‡ï¼Œ<br>__blockå˜é‡æŒæœ‰MyObjectç±»å¯¹è±¡ï¼›</p>
<p>æ‰“ç ´å¾ªç¯å¼•ç”¨æ–¹å¼ï¼šä½¿ç”¨å¯åœ¨blockè¯­å¥æ‰§è¡Œå®Œæˆæ—¶ï¼Œä½¿__blockå˜é‡ä¸åœ¨æŒæœ‰å¯¹è±¡ã€‚</p>
<p>3ã€<strong>block é¿å…å¾ªç¯å¼•ç”¨ ä¸ä½¿ç”¨</strong>weakä¿®é¥°ç¬¦åŠ<strong>unsafe_unretainedä¿®é¥°ç¬¦é¿å…å¾ªç¯å¼•ç”¨çš„ä¼˜ç‚¹ç¼ºç‚¹åœ¨å“ªï¼Ÿ<br>ä¼˜ç‚¹ï¼š<br>ï¼ˆ1ï¼‰</strong>blockå˜é‡å¯æ§åˆ¶å¯¹è±¡çš„æŒæœ‰æ—¶é—´ã€‚<br>ï¼ˆ2ï¼‰å†ä¸èƒ½ä½¿ç”¨<strong>weak ä¿®é¥°ç¬¦çš„ç¯å¢ƒä¸­ï¼ˆMRCä¸‹/åŸºç¡€æ•°æ®ç±»å‹æ—¶ï¼‰ï¼Œå¯ä»£æ›¿</strong>unsafe__unretainedæ¥é¿å…æ‚¬å‚æŒ‡é’ˆã€‚<br>æ³¨ï¼šæ‚¬å‚æŒ‡é’ˆï¼ˆdangling pointerï¼‰ä¸€èˆ¬æ˜¯è¯´æŒ‡å‘å·²ç»è¢«é‡Šæ”¾çš„è‡ªç”±åŒºå†…å­˜ï¼ˆfree storeï¼‰çš„æŒ‡é’ˆï¼Œé‡æŒ‡é’ˆï¼ˆwild pointerï¼‰åˆ™ä¸€èˆ¬æ˜¯æœªç»åˆå§‹åŒ–çš„æŒ‡é’ˆã€‚å‰è€…æ›¾ç»æœ‰æ•ˆè¿‡ï¼Œåè€…ä»æœªæœ‰æ•ˆè¿‡ã€‚</p>
<p>ä¼˜ç‚¹ï¼š<br>ï¼ˆ1ï¼‰ä¸ºé¿å…å¾ªç¯å¼•ç”¨å¿…é¡»æ‰§è¡Œblockã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">__block <span class="keyword">id</span> tmp = <span class="keyword">self</span>;</span><br><span class="line">blk = ^&#123;</span><br><span class="line">  tmp = <span class="literal">nil</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>åœ¨<a href="https://blog.ibireme.com" target="_blank" rel="noopener">https://blog.ibireme.com</a> æ€§èƒ½ä¼˜åŒ–çš„åšå®¢é‡Œï¼Œæœ‰å…³äºå½“å®¹å™¨ç±»æŒæœ‰å¤§é‡å¯¹è±¡æ—¶ï¼Œå¯¹å…¶é”€æ¯æ—¶çš„èµ„æºæ¶ˆè€—çš„ä¼˜åŒ–ã€‚æŠŠå¯¹è±¡ä¸¢åˆ°åå°çº¿ç¨‹å»é‡Šæ”¾ï¼Œç”¨åˆ°çš„tipsï¼šæŠŠå¯¹è±¡æ•è·åˆ° block ä¸­ï¼Œç„¶åæ‰”åˆ°åå°é˜Ÿåˆ—å»éšä¾¿å‘é€ä¸ªæ¶ˆæ¯ä»¥é¿å…ç¼–è¯‘å™¨è­¦å‘Šï¼Œå°±å¯ä»¥è®©å¯¹è±¡åœ¨åå°çº¿ç¨‹é”€æ¯äº†ã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">self</span>.array = [[<span class="built_in">NSArray</span> alloc]initWithObjects:@<span class="number">1</span>,@<span class="number">2</span>,@<span class="number">3</span>, <span class="literal">nil</span>];</span><br><span class="line"><span class="built_in">NSArray</span> *tmp = <span class="keyword">self</span>.array;</span><br><span class="line"><span class="keyword">self</span>.array = <span class="literal">nil</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">dispatch_async</span>(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_BACKGROUND, <span class="number">0</span>), ^&#123;</span><br><span class="line">    [tmp <span class="keyword">class</span>];</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>


















      
       <hr><span style="font-style: italic;color: gray;"> è½¬è½½è¯·æ³¨æ˜æ¥æºï¼Œæ¬¢è¿å¯¹æ–‡ç« ä¸­çš„å¼•ç”¨æ¥æºè¿›è¡Œè€ƒè¯ï¼Œæ¬¢è¿æŒ‡å‡ºä»»ä½•æœ‰é”™è¯¯æˆ–ä¸å¤Ÿæ¸…æ™°çš„è¡¨è¾¾ã€‚å¯ä»¥åœ¨ä¸‹é¢è¯„è®ºåŒºè¯„è®ºï¼Œä¹Ÿå¯ä»¥é‚®ä»¶è‡³ jaytp@qq.com </span>
    </div>
</article>







    




    </div>
    <div class="copyright">
        <p class="footer-entry">
    Â©2016-2020 Yelog
</p>
<p class="footer-entry">Built with <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/yelog/hexo-theme-3-hexo" target="_blank">3-hexo</a> theme</p>

    </div>
    <div class="full-toc">
        <button class="full" data-title="åˆ‡æ¢å…¨å± å¿«æ·é”® s"><span class="min "></span></button>
<a class="" id="rocket" ></a>

    </div>
</div>

</body>
<script src="/blog/js/jquery.pjax.js?v=1.1.0" ></script>

<script src="/blog/js/script.js?v=1.1.0" ></script>
<script>
    var img_resize = 'default';
    function initArticle() {
        /*æ¸²æŸ“å¯¹åº”çš„è¡¨æ ¼æ ·å¼*/
        
            $("#post .pjax table").addClass("green_title");
        

        /*æ¸²æŸ“æ‰“èµæ ·å¼*/
        

        /*é«˜äº®ä»£ç å—è¡Œå·*/
        

        /*è®¿é—®æ•°é‡*/
        
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js");
        

        /*ä»£ç é«˜äº®ï¼Œè¡Œå·å¯¹é½*/
        $('.pre-numbering').css('line-height',$('.has-numbering').css('line-height'));

        
        
    }

    /*æ‰“èµé¡µé¢éšè—ä¸å±•ç¤º*/
    

</script>

<!--åŠ å…¥è¡Œå·çš„é«˜äº®ä»£ç å—æ ·å¼-->

<!--è‡ªå®šä¹‰æ ·å¼è®¾ç½®-->
<style>
    
    
    .nav {
        width: 522px;
    }
    .nav.fullscreen {
        margin-left: -522px;
    }
    .nav-left {
        width: 100px;
    }
    
    
    @media screen and (max-width: 1468px) {
        .nav {
            width: 472px;
        }
        .nav.fullscreen {
            margin-left: -472px;
        }
        .nav-left {
            width: 80px;
        }
    }
    
    
    @media screen and (max-width: 1024px) {
        .nav {
            width: 472px;
            margin-left: -472px
        }
        .nav.fullscreen {
            margin-left: 0;
        }
    }
    
    @media screen and (max-width: 426px) {
        .nav {
            width: 100%;
        }
        .nav-left {
            width: 100%;
        }
    }
    
    
    .nav-right .title-list nav a .post-title, .nav-right .title-list #local-search-result a .post-title {
        color: #383636;
    }
    
    
    .nav-right .title-list nav a .post-date, .nav-right .title-list #local-search-result a .post-date {
        color: #5e5e5f;
    }
    
    
    .nav-right nav a.hover, #local-search-result a.hover{
        background-color: #e2e0e0;
    }
    
    

    /*åˆ—è¡¨æ ·å¼*/
    

    /* èƒŒæ™¯å›¾æ ·å¼ */
    
    


    /*å¼•ç”¨å—æ ·å¼*/
    

    /*æ–‡ç« åˆ—è¡¨èƒŒæ™¯å›¾*/
    

    
</style>






<div class="mobile-menus-out" >

</div>
<div class="mobile-menus">
    
    
    
    
    <a class="dynamic-menu " target="_blank"  href="https://github.com/xieyahao">github</a>
    
</div>


</html>
