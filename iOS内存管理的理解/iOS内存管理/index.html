<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>iOSå†…å­˜ç®¡ç†çš„ç†è§£/iOSå†…å­˜ç®¡ç† | yahaoâ€˜s note</title>
  <meta name="keywords" content="">
  <meta name="description" content="iOSå†…å­˜ç®¡ç†çš„ç†è§£/iOSå†…å­˜ç®¡ç† | yahaoâ€˜s note">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick">
<meta property="og:type" content="article">
<meta property="og:title" content="Hello World">
<meta property="og:url" content="https://xieyahao.github.io/blog/hello-world/index.html">
<meta property="og:site_name" content="yahaoâ€˜s note">
<meta property="og:description" content="Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick">
<meta property="og:locale" content="zh">
<meta property="article:published_time" content="2020-05-29T10:29:00.486Z">
<meta property="article:modified_time" content="2020-05-29T10:29:00.486Z">
<meta name="twitter:card" content="summary">


<link rel="icon" href="/img/avatar.jpg">

<link href="/blog/css/style.css?v=1.1.0" rel="stylesheet">

<link href="/blog/css/hl_theme/atom-light.css?v=1.1.0" rel="stylesheet">

<link href="//cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css" rel="stylesheet">

<script src="//cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<script src="/blog/js/titleTip.js?v=1.1.0" ></script>

<script src="//cdn.jsdelivr.net/npm/highlightjs@9.16.2/highlight.pack.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>

<script src="//cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script>



<script src="//cdn.jsdelivr.net/npm/jquery.cookie@1.4.1/jquery.cookie.min.js" ></script>

<script src="/blog/js/iconfont.js?v=1.1.0" ></script>

<meta name="generator" content="Hexo 4.2.1"></head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_preload_comment" value="">
  <input class="theme_blog_path" value="/blog">
  <input id="theme_shortcut" value="true" />
</div>


<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/blog/" class="avatar_target">
    <img class="avatar" src="/blog/img/avatar.jpg" />
</a>
<div class="author">
    <span></span>
</div>

<div class="icon">
    
</div>



<a class="more-menus">æ›´å¤šèœå•</a>


<ul>
    <li><div class="all active" data-rel="All">All<small>(5)</small></div></li>
    
</ul>
<div class="left-bottom">
    <div class="menus">
    
    
    
    
    <a class="dynamic-menu " target="_blank"  href="https://github.com/xieyahao">github</a>
    
    </div>
    <div></div>
</div>
<input type="hidden" id="yelog_site_posts_number" value="5">

<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>

    </div>
    <div class="nav-right">
        <div class="friends-area">
    <div class="friends-title">
        Links
        <i class="iconfont icon-left"></i>
    </div>
    <div class="friends-content">
        <ul>
            
        </ul>
    </div>
</div>
        <div class="title-list">
    <div class="right-top">
        <div id="default-panel">
            <i class="iconfont icon-search" data-title="æœç´¢ å¿«æ·é”® i"></i>
            <div class="right-title">All</div>
            <i class="iconfont icon-file-tree" data-title="åˆ‡æ¢åˆ°å¤§çº²è§†å›¾ å¿«æ·é”® w"></i>
        </div>
        <div id="search-panel">
            <i class="iconfont icon-left" data-title="è¿”å›"></i>
            <input id="local-search-input" />
            <label class="border-line" for="input"></label>
            <i class="iconfont icon-case-sensitive" data-title="å¤§å°å†™æ•æ„Ÿ"></i>
            <i class="iconfont icon-tag" data-title="æ ‡ç­¾"></i>
        </div>
        <div id="outline-panel" style="display: none">
            <div class="right-title">å¤§çº²</div>
            <i class="iconfont icon-list" data-title="åˆ‡æ¢åˆ°æ–‡ç« åˆ—è¡¨"></i>
        </div>
    </div>

    <div class="tags-list">
    <input id="tag-search" />
    <div class="tag-wrapper">
        
    </div>

</div>

    
    <nav id="title-list-nav">
        
        <a  class="All "
           href="/blog/iOS%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E7%9A%84%E7%90%86%E8%A7%A3/iOS%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="iOSå†…å­˜ç®¡ç†çš„ç†è§£/iOSå†…å­˜ç®¡ç†">iOSå†…å­˜ç®¡ç†çš„ç†è§£/iOSå†…å­˜ç®¡ç†</span>
            <span class="post-date" title="2021-03-29 12:07:53">2021/03/29</span>
        </a>
        
        <a  class="All "
           href="/blog/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0-core%20animation/coreAnimationAdvancedTechniques/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="è¯»ä¹¦ç¬”è®°-core animation/coreAnimationAdvancedTechniques">è¯»ä¹¦ç¬”è®°-core animation/coreAnimationAdvancedTechniques</span>
            <span class="post-date" title="2020-06-16 14:59:51">2020/06/16</span>
        </a>
        
        <a  class="All "
           href="/blog/hello-world/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Hello World">Hello World</span>
            <span class="post-date" title="2020-05-29 18:29:00">2020/05/29</span>
        </a>
        
        <a  class="All "
           href="/blog/block%E7%9A%84%E6%9C%AC%E8%B4%A8/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="blockçš„æœ¬è´¨">blockçš„æœ¬è´¨</span>
            <span class="post-date" title="2020-05-29 18:29:00">2020/05/29</span>
        </a>
        
        <a  class="All "
           href="/blog/runtime%E5%AD%A6%E4%B9%A0%E4%B8%80/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="runtimeå­¦ä¹ ä¸€">runtimeå­¦ä¹ ä¸€</span>
            <span class="post-date" title="2020-05-28 15:43:26">2020/05/28</span>
        </a>
        
        <div id="no-item-tips">

        </div>
    </nav>
    <div id="outline-list">
    </div>
</div>
    </div>
    <div class="hide-list">
        <div class="semicircle" data-title="åˆ‡æ¢å…¨å± å¿«æ·é”® s">
            <div class="brackets first"><</div>
            <div class="brackets">&gt;</div>
        </div>
    </div>
</aside>
<div id="post">
    <div class="pjax">
        <article id="post-iOSå†…å­˜ç®¡ç†çš„ç†è§£/iOSå†…å­˜ç®¡ç†" class="article article-type-post" itemscope itemprop="blogPost">
    
        <h1 class="article-title">iOSå†…å­˜ç®¡ç†çš„ç†è§£/iOSå†…å­˜ç®¡ç†</h1>
    
    <div class="article-meta">
        
        
        
        
    </div>
    <div class="article-meta">
        
            Created At : <time class="date" title='Updated At: 2021-03-30 11:06:27'>2021-03-29 12:07</time>
        
    </div>
    <div class="article-meta">
        
        
        <span id="busuanzi_container_page_pv">
            Views ğŸ‘€ :<span id="busuanzi_value_page_pv">
                <span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </span>
        </span>
        
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#iOSä¸­çš„å†…å­˜ç®¡ç†"><span class="toc-text">iOSä¸­çš„å†…å­˜ç®¡ç†</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1ã€æ‰‹åŠ¨ç®¡ç†å†…å­˜æ—¶ï¼Œå¼•ç”¨è®¡æ•°å¼å†…å­˜ç®¡ç†çš„æ€è€ƒæ–¹å¼æ˜¯æ€æ ·çš„ï¼Ÿ"><span class="toc-text">1ã€æ‰‹åŠ¨ç®¡ç†å†…å­˜æ—¶ï¼Œå¼•ç”¨è®¡æ•°å¼å†…å­˜ç®¡ç†çš„æ€è€ƒæ–¹å¼æ˜¯æ€æ ·çš„ï¼Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2ã€å¯¹äº-NSArray-array-ç”Ÿæˆçš„å¯¹è±¡ï¼Œéè‡ªå·±ç”Ÿæˆä½†æŒæœ‰æ˜¯å¦‚ä½•ç®¡ç†å†…å­˜çš„ï¼Ÿ"><span class="toc-text">2ã€å¯¹äº[NSArray array]ç”Ÿæˆçš„å¯¹è±¡ï¼Œéè‡ªå·±ç”Ÿæˆä½†æŒæœ‰æ˜¯å¦‚ä½•ç®¡ç†å†…å­˜çš„ï¼Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3ã€ARCä¸‹æ˜¯å¦‚ä½•ä½¿ç”¨autoreleaseçš„å‘¢ï¼Ÿ"><span class="toc-text">3ã€ARCä¸‹æ˜¯å¦‚ä½•ä½¿ç”¨autoreleaseçš„å‘¢ï¼Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4ã€æ‰€æœ‰æƒä¿®é¥°ç¬¦-ä¸‹çš„å†…å­˜ç®¡ç†"><span class="toc-text">4ã€æ‰€æœ‰æƒä¿®é¥°ç¬¦ ä¸‹çš„å†…å­˜ç®¡ç†</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5ã€è°ƒè¯•"><span class="toc-text">5ã€è°ƒè¯•</span></a></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-3 i,
    .toc-level-3 ol {
        display: none !important;
    }
</style>
</div>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="iOSä¸­çš„å†…å­˜ç®¡ç†"><a href="#iOSä¸­çš„å†…å­˜ç®¡ç†" class="headerlink" title="iOSä¸­çš„å†…å­˜ç®¡ç†"></a>iOSä¸­çš„å†…å­˜ç®¡ç†</h2><p>object-C ä¸­é‡‡å–ARCï¼ˆAutomatic Reference Countingï¼‰æœºåˆ¶ï¼Œè®©ç¼–è¯‘å™¨æ¥è¿›è¡Œå†…å­˜ç®¡ç†ã€‚</p>
<h2 id="1ã€æ‰‹åŠ¨ç®¡ç†å†…å­˜æ—¶ï¼Œå¼•ç”¨è®¡æ•°å¼å†…å­˜ç®¡ç†çš„æ€è€ƒæ–¹å¼æ˜¯æ€æ ·çš„ï¼Ÿ"><a href="#1ã€æ‰‹åŠ¨ç®¡ç†å†…å­˜æ—¶ï¼Œå¼•ç”¨è®¡æ•°å¼å†…å­˜ç®¡ç†çš„æ€è€ƒæ–¹å¼æ˜¯æ€æ ·çš„ï¼Ÿ" class="headerlink" title="1ã€æ‰‹åŠ¨ç®¡ç†å†…å­˜æ—¶ï¼Œå¼•ç”¨è®¡æ•°å¼å†…å­˜ç®¡ç†çš„æ€è€ƒæ–¹å¼æ˜¯æ€æ ·çš„ï¼Ÿ"></a>1ã€æ‰‹åŠ¨ç®¡ç†å†…å­˜æ—¶ï¼Œå¼•ç”¨è®¡æ•°å¼å†…å­˜ç®¡ç†çš„æ€è€ƒæ–¹å¼æ˜¯æ€æ ·çš„ï¼Ÿ</h2><ul>
<li>è‡ªå·±ç”Ÿæˆçš„å¯¹è±¡è‡ªå·±æŒæœ‰ï¼›</li>
<li>éè‡ªå·±ç”Ÿæˆçš„å¯¹è±¡ï¼Œè‡ªå·±ä¹Ÿèƒ½æŒæœ‰ï¼›</li>
<li>ä¸å†éœ€è¦è‡ªå·±æŒæœ‰çš„å¯¹è±¡æ—¶é‡Šæ”¾ï¼›</li>
<li>éè‡ªå·±æŒæœ‰çš„å¯¹è±¡æ— æ³•é‡Šæ”¾ï¼›</li>
</ul>
<p>å¯¹åº”äºOCé‡Œï¼Œ<br>alloc/new/copy/mutableCopyç­‰æ–¹æ³•   â€” ç”Ÿæˆå¹¶æŒæœ‰å¯¹è±¡ï¼›<br>retainæ–¹æ³• â€” æŒæœ‰å¯¹è±¡ï¼›<br>releaseæ–¹æ³• â€” é‡Šæ”¾å¯¹è±¡ï¼›<br>deallocæ–¹æ³• â€” åºŸå¼ƒå¯¹è±¡ï¼›</p>
<h2 id="2ã€å¯¹äº-NSArray-array-ç”Ÿæˆçš„å¯¹è±¡ï¼Œéè‡ªå·±ç”Ÿæˆä½†æŒæœ‰æ˜¯å¦‚ä½•ç®¡ç†å†…å­˜çš„ï¼Ÿ"><a href="#2ã€å¯¹äº-NSArray-array-ç”Ÿæˆçš„å¯¹è±¡ï¼Œéè‡ªå·±ç”Ÿæˆä½†æŒæœ‰æ˜¯å¦‚ä½•ç®¡ç†å†…å­˜çš„ï¼Ÿ" class="headerlink" title="2ã€å¯¹äº[NSArray array]ç”Ÿæˆçš„å¯¹è±¡ï¼Œéè‡ªå·±ç”Ÿæˆä½†æŒæœ‰æ˜¯å¦‚ä½•ç®¡ç†å†…å­˜çš„ï¼Ÿ"></a>2ã€å¯¹äº[NSArray array]ç”Ÿæˆçš„å¯¹è±¡ï¼Œéè‡ªå·±ç”Ÿæˆä½†æŒæœ‰æ˜¯å¦‚ä½•ç®¡ç†å†…å­˜çš„ï¼Ÿ</h2><p> autoreleaseï¼›<br> autorelease ä¼šåƒCè¯­è¨€çš„è‡ªåŠ¨å˜é‡é‚£æ ·ï¼Œè¶…å‡ºä½œç”¨åŸŸæ—¶ï¼Œè°ƒç”¨å®ä¾‹çš„release.ä¸åŒçš„æ˜¯ï¼Œæˆ‘ä»¬å¯è®¾ç½®ä½œç”¨åŸŸã€‚</p>
<p>3ã€autorelease æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ<br>ï¼ˆ1ï¼‰è°ƒç”¨å®ä¾‹çš„autoreleaseæ–¹æ³•ï¼Œå°±ç›¸å½“äºè°ƒç”¨æ­£åœ¨ä½¿ç”¨çš„autoreleasePoolå¯¹è±¡çš„addObjectçš„å®ä¾‹æ–¹æ³•ã€‚å°†è¯¥å¯¹è±¡è¿½åŠ åˆ°æ­£åœ¨ä½¿ç”¨çš„NSAutoreleasePoolå¯¹è±¡çš„æ•°ç»„é‡Œã€‚<br>ï¼ˆ2ï¼‰autoreleasePoolæ˜¯å¯åµŒå¥—çš„ã€‚<br>ï¼ˆ3ï¼‰autoreleasePoolå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸç›¸å½“äºä½œç”¨åŸŸã€‚åœ¨ARCç¯å¢ƒä¸‹ï¼Œä½¿ç”¨@autoreleasepoolæ¥å®šä¹‰è¿™ä¸ªèŒƒå›´ã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@autoreleasepool</span> &#123; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>4ã€autoreleasePoolæ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</p>
<p>ï¼ˆ1ï¼‰autoreleasePoolæ˜¯ä»¥autoreleasePageä¸ºå•ä½çš„åŒå‘é“¾è¡¨ã€‚<br>autoreleasePageæ˜¯ä¸€ä¸ªç»“æ„ä½“,æ¯ä¸€ä¸ª AutoreleasePoolPage çš„å¤§å°éƒ½æ˜¯ 4096 å­—èŠ‚.</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> *objc_autoreleasePoolPush(<span class="keyword">void</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> AutoreleasePoolPage::push();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> objc_autoreleasePoolPop(<span class="keyword">void</span> *ctxt) &#123;</span><br><span class="line">    AutoreleasePoolPage::pop(ctxt);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>åˆ›å»ºæ—¶ï¼Œè°ƒç”¨AutoreleasePoolPage çš„ç±»æ–¹æ³•pushï¼Œ</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span> *push() &#123;</span><br><span class="line">   <span class="keyword">return</span> autoreleaseFast(POOL_SENTINEL);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>AutoreleasePoolPageè°ƒç”¨autoreleaseFastæ–¹æ³•ï¼Œå¹¶ä¼ å…¥å“¨å…µå¯¹è±¡ï¼ˆç©ºå ä½ç¬¦ï¼‰ã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">id</span> *autoreleaseFast(<span class="keyword">id</span> obj)</span><br><span class="line">&#123;</span><br><span class="line">   AutoreleasePoolPage *page = hotPage();</span><br><span class="line">   <span class="keyword">if</span> (page &amp;&amp; !page-&gt;full()) &#123;</span><br><span class="line">       <span class="keyword">return</span> page-&gt;add(obj);</span><br><span class="line">   &#125; <span class="keyword">else</span> <span class="keyword">if</span> (page) &#123;</span><br><span class="line">       <span class="keyword">return</span> autoreleaseFullPage(obj, page);</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">       <span class="keyword">return</span> autoreleaseNoPage(obj);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨autoreleaseFastæ–¹æ³•é‡Œï¼Œ</p>
<ul>
<li>æœ‰ hotPage å¹¶ä¸”å½“å‰ page ä¸æ»¡<br>è°ƒç”¨ page-&gt;add(obj) æ–¹æ³•å°†å¯¹è±¡æ·»åŠ è‡³ AutoreleasePoolPage çš„æ ˆä¸­</li>
<li>æœ‰ hotPage å¹¶ä¸”å½“å‰ page å·²æ»¡<br>è°ƒç”¨ autoreleaseFullPage åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„é¡µ<br>è°ƒç”¨ page-&gt;add(obj) æ–¹æ³•å°†å¯¹è±¡æ·»åŠ è‡³ AutoreleasePoolPage çš„æ ˆä¸­</li>
<li>æ—  hotPage<br>è°ƒç”¨ autoreleaseNoPage åˆ›å»ºä¸€ä¸ª hotPage<br>è°ƒç”¨ page-&gt;add(obj) æ–¹æ³•å°†å¯¹è±¡æ·»åŠ è‡³ AutoreleasePoolPage çš„æ ˆä¸­</li>
</ul>
<p>autoreleaseFullPageï¼Œå°±æ˜¯å½“å‰hotPageå·²æ»¡æ—¶ï¼Œè°ƒç”¨çš„æ–¹æ³•</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">id</span> *autoreleaseFullPage(<span class="keyword">id</span> obj, AutoreleasePoolPage *page) &#123;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (page-&gt;child) page = page-&gt;child;</span><br><span class="line">        <span class="keyword">else</span> page = new AutoreleasePoolPage(page);</span><br><span class="line">    &#125; <span class="keyword">while</span> (page-&gt;full());</span><br><span class="line"></span><br><span class="line">    setHotPage(page);</span><br><span class="line">    <span class="keyword">return</span> page-&gt;add(obj);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å®ƒä¼šä»ä¼ å…¥çš„ page å¼€å§‹éå†æ•´ä¸ªåŒå‘é“¾è¡¨ï¼Œç›´åˆ°ï¼š</p>
<ul>
<li>æŸ¥æ‰¾åˆ°ä¸€ä¸ªæœªæ»¡çš„ AutoreleasePoolPageï¼Œæ ‡è®°ä¸ºhotPage ,æ‰§è¡ŒaddObj;</li>
<li>ä½¿ç”¨æ„é€ å™¨ä¼ å…¥ parent åˆ›å»ºä¸€ä¸ªæ–°çš„ AutoreleasePoolPageï¼›</li>
</ul>
<p>autoreleaseNoPageï¼Œå½“æ²¡æœ‰hotPage æ—¶ï¼Œè°ƒç”¨çš„æ–¹æ³•.ç”¨æ¥åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„AutoreleasePoolPageã€‚å¹¶è®¾ä¸ºhotPagï¼Œå†addObj.æ­¤æ—¶ï¼Œæ²¡æœ‰ç›¸å…³page å‚æ•°ï¼Œæ˜¯ä¸€ä¸ªä»å¤´åˆ›å»ºçš„åŒå‘é“¾è¡¨ï¼Œæ²¡æœ‰parentæŒ‡é’ˆã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">id</span> *autoreleaseNoPage(<span class="keyword">id</span> obj) &#123;</span><br><span class="line">    AutoreleasePoolPage *page = new AutoreleasePoolPage(<span class="literal">nil</span>);</span><br><span class="line">    setHotPage(page);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (obj != POOL_SENTINEL) &#123;</span><br><span class="line">        page-&gt;add(POOL_SENTINEL);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> page-&gt;add(obj);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> (2) objc_autoreleasePoolPop,åšäº†ä»€ä¹ˆå‘¢ï¼Ÿ<br> <figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span> pop(<span class="keyword">void</span> *token) &#123;</span><br><span class="line">    AutoreleasePoolPage *page = pageForPointer(token);</span><br><span class="line">    <span class="keyword">id</span> *stop = (<span class="keyword">id</span> *)token;</span><br><span class="line"></span><br><span class="line">    page-&gt;releaseUntil(stop);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (page-&gt;child) &#123;</span><br><span class="line">        <span class="keyword">if</span> (page-&gt;lessThanHalfFull()) &#123;</span><br><span class="line">            page-&gt;child-&gt;kill();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (page-&gt;child-&gt;child) &#123;</span><br><span class="line">            page-&gt;child-&gt;child-&gt;kill();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å¦‚æœæˆ‘ä»¬çš„ä¸€ä¸ª AutoreleasePoolPage è¢«åˆå§‹åŒ–åœ¨å†…å­˜çš„ 0x100816000 ~ 0x100817000 ä¸­ï¼Œå®ƒåœ¨å†…å­˜ä¸­çš„ç»“æ„ï¼š</p>
<p>æœ‰ 56 bit ç”¨äºå­˜å‚¨ AutoreleasePoolPage çš„æˆå‘˜å˜é‡ï¼Œå‰©ä¸‹çš„ 0x100816038 ~ 0x100817000 éƒ½æ˜¯ç”¨æ¥å­˜å‚¨åŠ å…¥åˆ°è‡ªåŠ¨é‡Šæ”¾æ± ä¸­çš„å¯¹è±¡ã€‚</p>
<p>begin() å’Œ end() è¿™ä¸¤ä¸ªç±»çš„å®ä¾‹æ–¹æ³•å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿè·å– 0x100816038 ~ 0x100817000 è¿™ä¸€èŒƒå›´çš„è¾¹ç•Œåœ°å€</p>
<p> objc_autoreleasePoolPushçš„è¿”å›å€¼æ­£æ˜¯è¿™ä¸ªå“¨å…µå¯¹è±¡çš„åœ°å€ï¼Œè¢«objc_autoreleasePoolPop(å“¨å…µå¯¹è±¡)ä½œä¸ºå…¥å‚ï¼Œäºæ˜¯ï¼š</p>
<p>ï¼ˆ1ï¼‰æ ¹æ®ä¼ å…¥çš„å“¨å…µå¯¹è±¡åœ°å€æ‰¾åˆ°å“¨å…µå¯¹è±¡æ‰€å¤„çš„page<br>ï¼ˆ2ï¼‰åœ¨å½“å‰pageä¸­ï¼Œå°†æ™šäºå“¨å…µå¯¹è±¡æ’å…¥çš„æ‰€æœ‰autoreleaseå¯¹è±¡éƒ½å‘é€ä¸€æ¬¡- releaseæ¶ˆæ¯ï¼Œå¹¶å‘å›ç§»åŠ¨nextæŒ‡é’ˆåˆ°æ­£ç¡®ä½ç½®<br>ï¼ˆ3ï¼‰è¡¥å……2ï¼šä»æœ€æ–°åŠ å…¥çš„å¯¹è±¡ä¸€ç›´å‘å‰æ¸…ç†ï¼Œå¯ä»¥å‘å‰è·¨è¶Šè‹¥å¹²ä¸ªpageï¼Œç›´åˆ°å“¨å…µæ‰€åœ¨çš„page</p>
<p>(1)ä½¿ç”¨ pageForPointer è·å–å½“å‰ token æ‰€åœ¨çš„ AutoreleasePoolPage.<br>(2)è°ƒç”¨ releaseUntil æ–¹æ³•é‡Šæ”¾æ ˆä¸­çš„å¯¹è±¡ï¼Œç›´åˆ° stop.<br>(3)è°ƒç”¨ child çš„ kill æ–¹æ³•.</p>
<p>å‚è€ƒé“¾æ¥ï¼š<br><a href="http://blog.sunnyxx.com/2014/10/15/behind-autorelease/" target="_blank" rel="noopener">http://blog.sunnyxx.com/2014/10/15/behind-autorelease/</a><br><a href="https://github.com/Draveness/analyze/blob/master/contents/objc/è‡ªåŠ¨é‡Šæ”¾æ± çš„å‰ä¸–ä»Šç”Ÿ.md" target="_blank" rel="noopener">https://github.com/Draveness/analyze/blob/master/contents/objc/è‡ªåŠ¨é‡Šæ”¾æ± çš„å‰ä¸–ä»Šç”Ÿ.md</a></p>
<h2 id="3ã€ARCä¸‹æ˜¯å¦‚ä½•ä½¿ç”¨autoreleaseçš„å‘¢ï¼Ÿ"><a href="#3ã€ARCä¸‹æ˜¯å¦‚ä½•ä½¿ç”¨autoreleaseçš„å‘¢ï¼Ÿ" class="headerlink" title="3ã€ARCä¸‹æ˜¯å¦‚ä½•ä½¿ç”¨autoreleaseçš„å‘¢ï¼Ÿ"></a>3ã€ARCä¸‹æ˜¯å¦‚ä½•ä½¿ç”¨autoreleaseçš„å‘¢ï¼Ÿ</h2><p>ï¼ˆ1ï¼‰åœ¨@autoreleasePool{}ä¸­å¼•ç”¨çš„å¯¹è±¡;<br> (2)èµ‹å€¼ç»™ï¼Œæ˜¾å¼åœ°ä½¿ç”¨<strong>autoreleasingä¿®é¥°ç¬¦çš„å˜é‡çš„å¯¹è±¡ã€‚<br> åŒ</strong>strong ä¿®é¥°ç¬¦ä¸€æ ·ï¼Œæ˜¾ç¤ºä½¿ç”¨æ¯”è¾ƒç½•è§ã€‚<br>ï¼ˆ3ï¼‰æ¥ä¸Šï¼Œå› ä¸ºï¼Œç¼–è¯‘å™¨ä¼šæ£€æŸ¥æ–¹æ³•åæ˜¯å¦ä»¥alloc/new/copy/mutableCopyå¼€å§‹ï¼Œå¦‚æœä¸æ˜¯ï¼Œä¼šè‡ªåŠ¨å°†è¿”å›å€¼æ³¨å†Œåˆ°autoreleasePoolã€‚ç¬¦åˆéè‡ªå·±ç”Ÿæˆè‡ªå·±ä¹Ÿèƒ½æŒæœ‰çš„æ€æƒ³å‡†åˆ™ã€‚<br>ï¼ˆ3ï¼‰ä½œä¸ºå‡½æ•°è¿”å›å€¼çš„å¯¹è±¡ï¼Œç¼–è¯‘å™¨ä¹Ÿä¼šè‡ªåŠ¨å°†å…¶æ³¨å†Œåˆ°autoreleasePoolã€‚</p>
<p> (4ï¼‰ä½¿ç”¨/è®¿é—®é™„æœ‰__weakä¿®é¥°ç¬¦çš„å˜é‡ï¼Œå°±æ˜¯ä½¿ç”¨æ³¨å†Œåˆ°autoreleasePoolçš„å¯¹è±¡ã€‚</p>
<h2 id="4ã€æ‰€æœ‰æƒä¿®é¥°ç¬¦-ä¸‹çš„å†…å­˜ç®¡ç†"><a href="#4ã€æ‰€æœ‰æƒä¿®é¥°ç¬¦-ä¸‹çš„å†…å­˜ç®¡ç†" class="headerlink" title="4ã€æ‰€æœ‰æƒä¿®é¥°ç¬¦ ä¸‹çš„å†…å­˜ç®¡ç†"></a>4ã€æ‰€æœ‰æƒä¿®é¥°ç¬¦ ä¸‹çš„å†…å­˜ç®¡ç†</h2><p>ï¼ˆ1ï¼‰__strongï¼›<br>æ˜¯idç±»å‹å’Œå¯¹è±¡ç±»å‹é»˜è®¤çš„æ‰€æœ‰æƒä¿®é¥°ç¬¦ï¼Œå› æ­¤ä¸éœ€è¦å†™ä¸Šè€Œæ˜¾å¾—æœ‰ç‚¹ç½•è§ï¼›<br>å†…å­˜ç®¡ç†çš„ç‰¹ç‚¹ï¼š</p>
<ul>
<li><p>é™„æœ‰__strongä¿®é¥°ç¬¦è¡¨ç¤ºå¯¹å¯¹è±¡çš„å¼ºå¼•ç”¨ï¼ŒæŒæœ‰å¼ºå¼•ç”¨çš„å˜é‡åœ¨è¶…å‡ºå…¶ä½œç”¨åŸŸæ—¶ï¼Œè¢«åºŸå¼ƒã€‚éšç€å¼ºå¼•ç”¨çš„å¤±æ•ˆï¼Œå¼•ç”¨çš„å¯¹è±¡é‡Šæ”¾ã€‚</p>
</li>
<li><p>å®¹æ˜“é€ æˆå¾ªç¯å¼•ç”¨ï¼Œå¼•èµ·å†…å­˜æ³„æ¼ã€‚</p>
<p>åœ¨ARCä¸­çš„å®ç°ï¼š</p>
</li>
</ul>
<p>ï¼ˆ2ï¼‰__weak</p>
<ul>
<li>å¼±å¼•ç”¨ï¼Œä¸æŒæœ‰å¯¹è±¡ã€‚åœ¨è¶…å‡ºå˜é‡ä½œç”¨åŸŸæ—¶ï¼Œå¯¹è±¡è¢«é‡Šæ”¾ã€‚</li>
<li>åœ¨æŒæœ‰æŸå¯¹è±¡çš„å¼±å¼•ç”¨æ—¶ï¼Œè‹¥è¯¥å¯¹è±¡è¢«åºŸå¼ƒï¼Œåˆ™æ­¤å¼±å¼•ç”¨å°†è‡ªåŠ¨å¤±æ•ˆä¸”ç½®nil;</li>
<li>ä½¿ç”¨é™„æœ‰__weak ä¿®é¥°ç¬¦çš„å˜é‡ï¼Œå³æ˜¯ä½¿ç”¨æ³¨å†Œåˆ°autoreleasePoolä¸­çš„å¯¹è±¡ã€‚</li>
</ul>
<p>åœ¨ARCä¸­çš„å®ç°ï¼š</p>
<ul>
<li><p>åˆå§‹åŒ–__weakä¿®é¥°ç¬¦çš„å˜é‡ï¼ˆobjc_initWeakï¼‰æ—¶ï¼Œ<br> ä¼šåˆ›å»ºweakè¡¨ï¼ˆç±»ä¼¼å¼•ç”¨è®¡æ•°çš„æ•£åˆ—è¡¨ï¼‰ï¼Œä»¥å¯¹è±¡åœ°å€ä¸ºkey,å¼±å¼•ç”¨å¯¹è±¡çš„å˜é‡åœ°å€ä¸ºå€¼ï¼ˆä¸€æˆ–å¤šä¸ªï¼‰ã€‚</p>
<ul>
<li>å½“å¯¹è±¡è¢«é”€æ¯æ—¶ï¼Œä»weakè¡¨ä¸­è·å–è¢«åºŸå¼ƒå¯¹è±¡çš„åœ°å€ä¸ºé”®å€¼çš„è®°å½•ã€‚</li>
<li>å°†åŒ…å«åœ¨è®°å½•é‡Œçš„æ‰€æœ‰å¼±å¼•ç”¨å˜é‡çš„åœ°å€ï¼Œèµ‹å€¼ä¸ºnil;</li>
<li>ä»weakè¡¨é‡Œåˆ é™¤è¯¥è®°å½•ï¼›</li>
<li>ä»å¼•ç”¨è®¡æ•°è¡¨ä¸­ï¼Œåˆ é™¤åºŸå¼ƒå¯¹è±¡çš„çš„åœ°å€ä¸ºé”®å€¼çš„è®°å½•ï¼›</li>
</ul>
</li>
</ul>
<p>(3)__unsafe_unretained</p>
<p>(4)__autoreleasing ä¿®é¥°ç¬¦</p>
<h2 id="5ã€è°ƒè¯•"><a href="#5ã€è°ƒè¯•" class="headerlink" title="5ã€è°ƒè¯•"></a>5ã€è°ƒè¯•</h2><p>_objc_autoreleasePoolPrint()å¯ç”¨æ¥è§‚å¯Ÿæ³¨å†Œåˆ°autoreleasePoolçš„å¼•ç”¨å¯¹è±¡ã€‚</p>
<p>_obj_rootRetainCount(obj) æ¥è·å–å½“å‰å¼•ç”¨è®¡æ•°ã€‚å½“å¯¹è±¡åŠ å…¥åˆ°autoreleasePoolæ—¶ï¼Œå…¶å¼•ç”¨è®¡æ•°ä¹Ÿä¼š+1ï¼›</p>

      
       <hr><span style="font-style: italic;color: gray;"> è½¬è½½è¯·æ³¨æ˜æ¥æºï¼Œæ¬¢è¿å¯¹æ–‡ç« ä¸­çš„å¼•ç”¨æ¥æºè¿›è¡Œè€ƒè¯ï¼Œæ¬¢è¿æŒ‡å‡ºä»»ä½•æœ‰é”™è¯¯æˆ–ä¸å¤Ÿæ¸…æ™°çš„è¡¨è¾¾ã€‚å¯ä»¥åœ¨ä¸‹é¢è¯„è®ºåŒºè¯„è®ºï¼Œä¹Ÿå¯ä»¥é‚®ä»¶è‡³ jaytp@qq.com </span>
    </div>
</article>







    




    </div>
    <div class="copyright">
        <p class="footer-entry">
    Â©2016-2020 Yelog
</p>
<p class="footer-entry">Built with <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/yelog/hexo-theme-3-hexo" target="_blank">3-hexo</a> theme</p>

    </div>
    <div class="full-toc">
        <button class="full" data-title="åˆ‡æ¢å…¨å± å¿«æ·é”® s"><span class="min "></span></button>
<a class="" id="rocket" ></a>

    </div>
</div>

</body>
<script src="/blog/js/jquery.pjax.js?v=1.1.0" ></script>

<script src="/blog/js/script.js?v=1.1.0" ></script>
<script>
    var img_resize = 'default';
    function initArticle() {
        /*æ¸²æŸ“å¯¹åº”çš„è¡¨æ ¼æ ·å¼*/
        
            $("#post .pjax table").addClass("green_title");
        

        /*æ¸²æŸ“æ‰“èµæ ·å¼*/
        

        /*é«˜äº®ä»£ç å—è¡Œå·*/
        

        /*è®¿é—®æ•°é‡*/
        
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js");
        

        /*ä»£ç é«˜äº®ï¼Œè¡Œå·å¯¹é½*/
        $('.pre-numbering').css('line-height',$('.has-numbering').css('line-height'));

        
        
    }

    /*æ‰“èµé¡µé¢éšè—ä¸å±•ç¤º*/
    

</script>

<!--åŠ å…¥è¡Œå·çš„é«˜äº®ä»£ç å—æ ·å¼-->

<!--è‡ªå®šä¹‰æ ·å¼è®¾ç½®-->
<style>
    
    
    .nav {
        width: 522px;
    }
    .nav.fullscreen {
        margin-left: -522px;
    }
    .nav-left {
        width: 100px;
    }
    
    
    @media screen and (max-width: 1468px) {
        .nav {
            width: 472px;
        }
        .nav.fullscreen {
            margin-left: -472px;
        }
        .nav-left {
            width: 80px;
        }
    }
    
    
    @media screen and (max-width: 1024px) {
        .nav {
            width: 472px;
            margin-left: -472px
        }
        .nav.fullscreen {
            margin-left: 0;
        }
    }
    
    @media screen and (max-width: 426px) {
        .nav {
            width: 100%;
        }
        .nav-left {
            width: 100%;
        }
    }
    
    
    .nav-right .title-list nav a .post-title, .nav-right .title-list #local-search-result a .post-title {
        color: #383636;
    }
    
    
    .nav-right .title-list nav a .post-date, .nav-right .title-list #local-search-result a .post-date {
        color: #5e5e5f;
    }
    
    
    .nav-right nav a.hover, #local-search-result a.hover{
        background-color: #e2e0e0;
    }
    
    

    /*åˆ—è¡¨æ ·å¼*/
    

    /* èƒŒæ™¯å›¾æ ·å¼ */
    
    


    /*å¼•ç”¨å—æ ·å¼*/
    

    /*æ–‡ç« åˆ—è¡¨èƒŒæ™¯å›¾*/
    

    
</style>






<div class="mobile-menus-out" >

</div>
<div class="mobile-menus">
    
    
    
    
    <a class="dynamic-menu " target="_blank"  href="https://github.com/xieyahao">github</a>
    
</div>


</html>
